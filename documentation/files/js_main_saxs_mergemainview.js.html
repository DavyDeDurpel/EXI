<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/main/saxs/mergemainview.js - EXI</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EXI" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AutoProcIntegrationGrid.html">AutoProcIntegrationGrid</a></li>
                                <li><a href="../classes/ManagerWelcomeMainView.html">ManagerWelcomeMainView</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: js/main/saxs/mergemainview.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
function MergeMainView() {
	this.title = &quot;Primary Data View&quot;;
	this.icon = &#x27;images/icon/ic_blur_on_black_18dp.png&#x27;;
	this.queueGridList = [];

	var _this = this;

	/** Curve plotter * */
	this.plotter = new CurvePlotter({});
	this.formPopulated = false;
	this.plotter.onRendered.attach(function(sender) {
		/** only once * */
		if (!_this.formPopulated) {
			/** colors * */
			var colors = {};
			for (var i = 1; i &lt; sender.getLabels().length; i++) {
				colors[sender.getLabels()[i]] = sender.getColors()[i - 1];
			}

			_this.populateForm(sender.getPointCount(), colors);
			_this.formPopulated = true;
		}
		plotter = sender;
	});
}

MergeMainView.prototype.getPanel = MainView.prototype.getPanel;
MergeMainView.prototype.getContainer = MainView.prototype.getContainer;

MergeMainView.prototype.populateForm = function(pointCount, colors) {
	for (var i = 0; i &lt; this.frames.length; i++) {
		this.editorPanel.add(this.getCurveContainer(this.frames[i].subtractionId, this.frames[i].fileName, 0, 5, this.frames[i].scale,
				pointCount, colors));
	}
};

MergeMainView.prototype.getSelected = function() {
	var selected = [];
	for (var i = 0; i &lt; this.queueGridList.length; i++) {
		selected = this.queueGridList[i].getSelected().concat(selected);
	}
	return selected;
};

MergeMainView.prototype.getCurveContainer = function(subtractionId, fileName, from, to, scale, pointCount, colors) {
	var _this = this;
	return Ext.create(&#x27;Ext.Panel&#x27;, {
		width : 380,
		layout : &#x27;vbox&#x27;,
		border : 1,
		style : {
			// borderColor : colors[fileName],
			borderStyle : &#x27;solid&#x27;,
			borderWidth : &#x27;1px&#x27; },
		margin : &#x27;10 0 0 5&#x27;,
		items : [ {
			xtype : &#x27;container&#x27;,
			margin : &#x27;0 0 0 0&#x27;,
			layout : &#x27;hbox&#x27;,
			items : [ {
				xtype : &#x27;container&#x27;,
				layout : &#x27;vbox&#x27;,
				items : [ {
					html : &#x27;&lt;span style=&quot;font-size:12px;color:&#x27; + colors[fileName] + &#x27;;&quot;&gt;&#x27; + fileName + &#x27;&lt;/span&gt;&#x27;,
					margin : &#x27;10 0 0 10&#x27; },

				{
					xtype : &#x27;sliderfield&#x27;,
					margin : &#x27;10 0 0 2&#x27;,
					hideLabel : true,
					width : 275,
					minValue : 0,
					subtractionId : subtractionId,
					id : &quot;slider&quot; + subtractionId,
					maxValue : pointCount,
					increment : 1,
					values : [ 0, pointCount ],
					listeners : {
						changecomplete : function(slider, newValue, thumb, eOpts) {
							var values = slider.getValues();
							for (var i = 0; i &lt; _this.frames.length; i++) {
								if (_this.frames[i].subtractionId == slider.subtractionId) {
									_this.frames[i].from = _this.plotter.dygraph.getValue(values[0] - 1, 0);
									_this.frames[i].to = _this.plotter.dygraph.getValue(values[1] - 1, 0);
								}
							}
							_this.updateCurve();
						} } } ] }, {
				xtype : &#x27;container&#x27;,
				layout : &#x27;vbox&#x27;,
				items : [ {
					xtype : &#x27;container&#x27;,
					layout : &#x27;hbox&#x27;,
					items : [ {
						xtype : &#x27;button&#x27;,
						text : &#x27;&lt;&#x27;,
						width : 30,
						margin : &#x27;2 0 0 10&#x27;,
						subtractionId : subtractionId,
						handler : function(sender) {
							var id = &quot;slider&quot; + sender.subtractionId;
							Ext.getCmp(id).setValue(0, Ext.getCmp(id).getValues()[0] - 1);
							var values = Ext.getCmp(id).getValues();
							for (var i = 0; i &lt; _this.frames.length; i++) {
								if (_this.frames[i].subtractionId == sender.subtractionId) {
									_this.frames[i].from = _this.plotter.dygraph.getValue(values[0] - 1, 0);
								}
							}

							_this.updateCurve();
						} }, {
						xtype : &#x27;button&#x27;,
						text : &#x27;&gt;&#x27;,
						width : 30,
						margin : &#x27;2 0 0 5&#x27;,
						subtractionId : subtractionId,
						handler : function(sender) {
							var id = &quot;slider&quot; + sender.subtractionId;
							Ext.getCmp(id).setValue(1, Ext.getCmp(id).getValues()[1] + 1);
							var values = Ext.getCmp(id).getValues();
							for (var i = 0; i &lt; _this.frames.length; i++) {
								if (_this.frames[i].subtractionId == sender.subtractionId) {
									_this.frames[i].to = _this.plotter.dygraph.getValue(values[1] - 1, 0);
								}
							}
							_this.updateCurve();
						} }

					]

				}, {
					xtype : &#x27;container&#x27;,
					layout : &#x27;hbox&#x27;,
					margin : &#x27;2 0 2 0&#x27;,
					items : [ {
						xtype : &#x27;button&#x27;,
						text : &#x27;+&#x27;,
						margin : &#x27;0 0 0 10&#x27;,
						width : 30,
						subtractionId : subtractionId,
						handler : function(sender) {
							for (var i = 0; i &lt; _this.frames.length; i++) {
								console.log(sender.subtractionId);
								if (_this.frames[i].subtractionId == sender.subtractionId) {
									_this.frames[i].scale = _this.frames[i].scale + 0.1;
								}
							}
							_this.updateCurve();
						} }, {
						xtype : &#x27;button&#x27;,
						text : &#x27;-&#x27;,
						width : 30,
						margin : &#x27;0 0 0 5&#x27;,
						subtractionId : subtractionId,
						handler : function(sender) {
							for (var i = 0; i &lt; _this.frames.length; i++) {
								if (_this.frames[i].subtractionId == sender.subtractionId) {
									_this.frames[i].scale = _this.frames[i].scale - 0.1;
								}
							}
							_this.updateCurve();
						} } ] } ] }

			] }

		] });
};

MergeMainView.prototype.getSubtractionEditor = function() {
	var _this = this;
	this.editorPanel = Ext.create(&#x27;Ext.Panel&#x27;, {
		border : 1,
		height : 600,
		width : 400,
		layout : &#x27;vbox&#x27;,
		scrollable : true,
		style : {
			borderColor : &#x27;#000000&#x27;,
			borderStyle : &#x27;solid&#x27;,
			borderWidth : &#x27;1px&#x27; },
		items : [],
		bbar : [ {
					text : &quot;Download&quot;,
					xtype : &#x27;button&#x27;,
					handler : function(sender) {
						var params = _this.getParams();
						window.open(new DataAdapter().getMergeURL(params.subtractionIds.toString(), params.from.toString(), params.to.toString(), params.scale.toString()));
					}
		}]
//		{
//			xtype : &#x27;button&#x27;,
//			text : &#x27;Download&#x27;,
//			margin : &#x27;0 0 0 10&#x27;,
//			width : 30,
//			handler : function(sender) {
//
//			} } ] 
			
	});
	return this.editorPanel;
};

MergeMainView.prototype.getParams = function() {
	var from = [];
	var to = [];
	var scale = [];
	var subtractionIds = [];
	for (var i = 0; i &lt; this.frames.length; i++) {
		var frame = this.frames[i];
		if (frame.from != null) {
			from.push(frame.from);
		} else {
			from.push(&quot;&quot;);
		}
		if (frame.to != null) {
			to.push(frame.to);
		} else {
			to.push(&quot;&quot;);
		}
		if (frame.scale != null) {
			scale.push(frame.scale);
		} else {
			scale.push(&quot;&quot;);
		}
		if (frame.subtractionId != null) {
			subtractionIds.push(frame.subtractionId);
		} else {
			subtractionIds.push(&quot;&quot;);
		}
	}
	return {
		from : from,
		to : to,
		scale : scale,
		subtractionIds : subtractionIds,
		
	};
};

MergeMainView.prototype.updateCurve = function() {
	

	/** Saving zoom * */
	this.xAxisRange = this.plotter.dygraph.xAxisRange();
	this.yAxisRange = this.plotter.dygraph.yAxisRange();

	var params = this.getParams();
	this.plotter.loadMerge(params.subtractionIds.toString(), params.from.toString(), params.to.toString(), params.scale.toString());
	this.plotter.dygraph.updateOptions({
		dateWindow : this.xAxisRange,
		valueRange : this.yAxisRange });
};

MergeMainView.prototype.getSlavePanel = function() {
	return {
		xtype : &#x27;container&#x27;,
		layout : &#x27;hbox&#x27;,
		cls : &#x27;defaultGridPanel&#x27;,
		border : 0,
		defaults : {
			xtype : &#x27;container&#x27;,
			height : 600 },
		items : [ this.getSubtractionEditor(), this.plotter.getPanel() ] };
};

MergeMainView.prototype.load = function(selected) {
	var _this = this;

	var grid = new QueueGrid({
		maxHeight : 300

	});

	this.panel.setTitle(&quot;Merge Tool&quot;);
	this.container.insert(0, grid.getPanel());

	this.container.insert(1, this.getSlavePanel());
	grid.load(selected);
	grid.panel.setLoading(false);

	var dataCollectionIds = [];
	var subtractionIds = [];
	var subtractionKey = [];

	this.frames = [];
	for (var i = 0; i &lt; selected.length; i++) {

		dataCollectionIds.push(selected[i].dataCollectionId);
		if (subtractionKey[selected[i].subtractionId] == null) {
			subtractionIds.push(selected[i].subtractionId);
			this.frames.push({
				&#x27;fileName&#x27; : selected[i].substractedFilePath.substr(selected[i].substractedFilePath.lastIndexOf(&quot;/&quot;) + 1),
				&#x27;subtractionId&#x27; : selected[i].subtractionId,
				&#x27;scale&#x27; : 1 });

			subtractionKey[selected[i].subtractionId] = true;
		}
	}

	/** Loading the subtraction on the curve Plotter * */
	this.plotter.load({
		subtracted : subtractionIds });

};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
