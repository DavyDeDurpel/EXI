<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/widget/form/macromolecule/macromoleculeform.js - EXI</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EXI" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ManagerWelcomeMainView.html">ManagerWelcomeMainView</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: js/widget/form/macromolecule/macromoleculeform.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Macromolecule form with the general parameters of a macromolecule
 * 
 * @witdh
 * @height
 * 
 * #onSave button save has been clicked
 * #onClose button close has been clicked
 */
function MacromoleculeForm(args) {
	this.id = BUI.id();
	this.width = 700;
	this.height = 700;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}
	
	/** Events **/
	this.onSave = new Event(this);
	this.onClose = new Event(this);
}

/** Type : is the Ext type then requiredtext or textfield * */
MacromoleculeForm.prototype._getFieldTextWithHelp = function(type, fieldLabel, fieldName, help) {
	return Ext.create(&#x27;Ext.container.Container&#x27;, {
		items : [ {
			xtype : type,
			fieldLabel : fieldLabel,
			name : fieldName,
			id : this.id + fieldName
		}, {
			xtype : &#x27;label&#x27;,
			forId : &#x27;myFieldId&#x27;,
			text : help,
			margin : &quot;5 0 0 105&quot;,
			cls : &quot;inline-help&quot;
		} ]
	});
};

MacromoleculeForm.prototype._getNumericWithHelp = function(type, fieldLabel, fieldName, help) {
	return Ext.create(&#x27;Ext.container.Container&#x27;, {
		margin : &quot;0 0 0 10&quot;,
		items : [ {
			xtype : type,
			fieldLabel : fieldLabel,
			name : fieldName,
			id : this.id + fieldName,
			decimalPrecision : 6,
			width : 220
		}, {
			xtype : &#x27;label&#x27;,
			forId : &#x27;myFieldId&#x27;,
			text : help,
			margin : &quot;5 0 0 10&quot;,
			cls : &quot;inline-help&quot;
		} ]
	});
};

MacromoleculeForm.prototype._getButtons = function() {
	var _this = this;
	return [ {
		text : &#x27;Save&#x27;,
		handler : function() {
			_this._save();
		}
	}
	];
};

/** It persits the macromolecule in the database **/
MacromoleculeForm.prototype._persist = function(macromoleculeId, acronym, name, molecularMass, extintionCoefficient, comments, refractiveIndex, solventViscosity) {
	var proposalId = Ext.getCmp(&quot;proposalIdCombo&quot;).getValue();
	if (proposalId == null){
			BUI.showError(&quot;Please select a proposal&quot;);
			return;
	}
	
	/** Checking not duplicated acronym **/
	if (macromoleculeId == null){
		if (EXI.proposalManager.getMacromoleculeByAcronym(acronym) != null){
			BUI.showError(&quot;Duplicated acronym&quot;);
			return;
		}
	}
	
	if (macromoleculeId == null){
		/** new macromolecule **/
		this.macromolecule = {};
		this.macromolecule.macromoleculeId = null;
	}
	else{
		this.macromolecule.macromoleculeId = macromoleculeId;
	}
	
	this.macromolecule[&quot;acronym&quot;] = acronym;
	this.macromolecule[&quot;name&quot;] = name;
	this.macromolecule[&quot;molecularMass&quot;] = molecularMass;
	this.macromolecule[&quot;extintionCoefficient&quot;] = extintionCoefficient;
	this.macromolecule[&quot;comments&quot;] = comments;
	this.macromolecule[&quot;symmetry&quot;] =  Ext.getCmp(this.id + &#x27;comboSym&#x27;).getValue();
	this.macromolecule[&quot;refractiveIndex&quot;] =  refractiveIndex;
	this.macromolecule[&quot;solventViscosity&quot;] =  solventViscosity;
	this.macromolecule[&quot;proposalId&quot;] =  proposalId;
	
	var _this = this;
	
	var onSuccess = (function(sender, proposal) {
		var onSuccess2 = function(sender, proposals){
			_this.panel.setLoading(false);
			_this.onSave.notify();
			_this.onClose.notify();
		};
		_this.panel.setLoading(&quot;Updading proposal information&quot;);
		EXI.getDataAdapter({onSuccess : onSuccess2}).proposal.proposal.update();
		
//		var manager = new ProposalUpdater(); 
//		manager.onSuccess.attach(function(sender, proposals){
//			_this.load(ProposalManager.getBuffers());	
//			_this.panel.setLoading(false);
//			_this.onClose.notify();
//		});
//		_this.panel.setLoading();
//		manager.get(true);
		
	});
	
	this.panel.setLoading(&quot;Saving Macromolecule&quot;);
	EXI.getDataAdapter({onSuccess: onSuccess }).saxs.macromolecule.saveMacromolecule(this.macromolecule);
};

/** Save the macromolecule in the DB **/
MacromoleculeForm.prototype._save = function() {
	
	var _this = this;
	
	var acronym = this._getField(&quot;acronym&quot;);
	var name = this._getField(&quot;name&quot;);
	var molecularMass = this._getField(&quot;molecularMass&quot;);
	var extintionCoefficient = this._getField(&quot;extintionCoefficient&quot;);
	var comments = this._getField(&quot;comments&quot;);
	
	var refractiveIndex = this._getField(&quot;refractiveIndex&quot;);
	var solventViscosity = this._getField(&quot;solventViscosity&quot;);
	
	/** Checking required fields **/
	if (name == &quot;&quot;) {
		BUI.showError(&quot;Name field is mandatory&quot;);
		return;
	}
	if (acronym == &quot;&quot;) {
		BUI.showError(&quot;Acroynm field is mandatory&quot;);
		return;
	}

	if (this.macromolecule != null){
		/** Checking if it is a new macromolecule **/
		if (this.macromolecule.macromoleculeId == null){
			/** Check if the acronym exists already **/
			this._persist(null, acronym, name, molecularMass, extintionCoefficient, comments, refractiveIndex, solventViscosity);
		}
		else{
			/** It is an update **/
			this._persist(this.macromolecule.macromoleculeId, acronym, name, molecularMass, extintionCoefficient, comments, refractiveIndex, solventViscosity);
		}
	}
	else{
		/** It is a new macromolecule **/
		this._persist(null, acronym, name, molecularMass, extintionCoefficient, comments, refractiveIndex, solventViscosity);
	}
};



MacromoleculeForm.prototype._getItems = function() {
	var _this = this;
	/** Symmetry combo box **/
	var symmetry = Ext.create(&#x27;Ext.data.Store&#x27;, {
		fields : [ &#x27;s&#x27; ],
		data : this._getSymmetries()
	});

	this.symmetryComboBox = Ext.create(&#x27;Ext.form.ComboBox&#x27;, {
		fieldLabel : &#x27;Symmetry&#x27;,
		store : symmetry,
		id : this.id + &#x27;comboSym&#x27;,
		queryMode : &#x27;local&#x27;,
		displayField : &#x27;s&#x27;,
		valueField : &#x27;s&#x27;,
		value : &quot;P1&quot;, 
		margin : &quot;0 0 0 30&quot;,
		width : 220
	});
	return [ BIOSAXS_COMBOMANAGER.getComboProposal({labelWidth : 100}),
	         this._getFieldTextWithHelp(&quot;requiredtextfield&quot;, &quot;Name&quot;, &quot;name&quot;, &quot;Long name. i.e: Bovine serum albumin&quot;),
			 this._getFieldTextWithHelp(&quot;requiredtextfield&quot;, &quot;Acronym&quot;, &quot;acronym&quot;, &quot;Acronym will be used in the files and analisys. i.e: BSA&quot;),
			 this._getFieldTextWithHelp(&quot;textfield&quot;, &quot;Mol. Mass (Da)&quot;, &quot;molecularMass&quot;, &quot;Atomic mass estimation measured in Da&quot;),
			{
				xtype : &#x27;container&#x27;,
				layout : &#x27;hbox&#x27;,
				margin : &quot;10 0 0 0&quot;,
				items :[
				        	this._getNumericWithHelp(&quot;numberfield&quot;, &quot;Extinction coef.&quot;, &quot;extintionCoefficient&quot;, &quot;&quot;),
							this.symmetryComboBox
				        ]
			},
			{
				xtype : &#x27;container&#x27;,
				layout : &#x27;hbox&#x27;,
				margin : &quot;5 0 0 0&quot;,
				items :[
				        	this._getNumericWithHelp(&quot;numberfield&quot;, &quot;Refractive Index&quot;, &quot;refractiveIndex&quot;, &quot;How radiation propagates through the medium&quot;),
							this._getNumericWithHelp(&quot;numberfield&quot;, &quot;Solvent Viscosity&quot;, &quot;solventViscosity&quot;, &quot;&quot;)
				]
					
		
			},
			
			
			{
				id : this.id + &quot;comments&quot;,
				xtype : &#x27;textareafield&#x27;,
				name : &#x27;comments&#x27;,
				margin : &#x27;35 0 0 10&#x27;,
				fieldLabel : &#x27;Comments&#x27;,
				width : this.width - 100,
				height : 100
			} ];
	
	return  Ext.create(&#x27;Ext.form.Panel&#x27;, {
		width : this.width,
		height : this.height,
		items : this._getItems()
	});
};

MacromoleculeForm.prototype._getSymmetries = function() {
	return  [ {
		&quot;s&quot; : &quot;P1&quot;
	}, {
		&quot;s&quot; : &quot;P2&quot;
	}, {
		&quot;s&quot; : &quot;P3&quot;
	}, {
		&quot;s&quot; : &quot;P4&quot;
	}, {
		&quot;s&quot; : &quot;P5&quot;
	}, {
		&quot;s&quot; : &quot;P6&quot;
	}, {
		&quot;s&quot; : &quot;P32&quot;
	}, {
		&quot;s&quot; : &quot;P42&quot;
	}, {
		&quot;s&quot; : &quot;P52&quot;
	}, {
		&quot;s&quot; : &quot;P62&quot;
	}, {
		&quot;s&quot; : &quot;P222&quot;
	} ];
};

MacromoleculeForm.prototype.getPanel = function() {
	this.panel =  Ext.create(&#x27;Ext.panel.Panel&#x27;, {
		layout : &#x27;hbox&#x27;,
		buttons : this._getButtons(),
		cls : &#x27;border-grid&#x27;,
		items : [
		         {
					xtype : &#x27;container&#x27;,
					margin : &#x27;20 0 0 20&#x27;,
					layout : &#x27;vbox&#x27;,
					items : this._getItems()
		         }]
	});
	return this.panel;
};


/** Populates each text field by field name and value **/
MacromoleculeForm.prototype._populateField = function(fieldName, value) {
	if (value != null){
		Ext.getCmp(this.id + fieldName).setValue(value);
	}
};

/** Gets the value of a textfield **/
MacromoleculeForm.prototype._getField = function(fieldName) {
	return Ext.getCmp(this.id + fieldName).getValue();
};


/** It populates the form **/
MacromoleculeForm.prototype.load = function(macromolecule) {
	this.macromolecule = macromolecule;
	if (macromolecule != null){
		this._populateField(&quot;name&quot;, macromolecule.name);
		this._populateField(&quot;acronym&quot;, macromolecule.acronym);
		this._populateField(&quot;extintionCoefficient&quot;, macromolecule.extintionCoefficient);
		this._populateField(&quot;molecularMass&quot;, macromolecule.molecularMass);
		this._populateField(&quot;comments&quot;, macromolecule.comments);
		this._populateField(&quot;refractiveIndex&quot;, macromolecule.refractiveIndex);
		this._populateField(&quot;solventViscosity&quot;, macromolecule.solventViscosity);
		if (macromolecule.symmetry != null){
			Ext.getCmp(this.id + &#x27;comboSym&#x27;).setValue(macromolecule.symmetry);
		}
		if (this.macromolecule.proposalId != null){
			Ext.getCmp(&quot;proposalIdCombo&quot;).setValue(this.macromolecule.proposalId);
			Ext.getCmp(&quot;proposalIdCombo&quot;).disable();
		}
		
	}
};


MacromoleculeForm.prototype.input = function() {
	return {};
};


/** It populates the form **/
MacromoleculeForm.prototype.test = function(targetId) {
	var macromoleculeForm = new MacromoleculeForm();
	macromoleculeForm.onClose.attach(function(sender){
		alert(&quot;Click on close&quot;);
	});
	var panel = macromoleculeForm.getPanel();
	panel.render(targetId);
};



    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
