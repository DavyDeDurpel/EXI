<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/main/mx/autoprocintegrationmainview.js - EXI</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EXI" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AutoProcIntegrationGrid.html">AutoProcIntegrationGrid</a></li>
                                <li><a href="../classes/ManagerWelcomeMainView.html">ManagerWelcomeMainView</a></li>
                                <li><a href="../classes/PhasingNetworkWidget.html">PhasingNetworkWidget</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: js/main/mx/autoprocintegrationmainview.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
function AutoProcIntegrationMainView() {
	this.icon = &#x27;images/icon/ic_satellite_black_18dp.png&#x27;;
	MainView.call(this);
	var _this = this;
	
	
	this.slaveWidth = 600;
	
	this.autoProcIntegrationGrid = new AutoProcIntegrationGrid({ maxHeight: 900});
	
	this.autoProcIntegrationGrid.onSelected.attach(function(sender, records){
		var ids = [];
		for (var i = 0; i &lt; records.length; i++) {
			ids.push(records[i].autoProcIntegrationId);
		}
		
		/** Loading plots **/
		try{
			_this.loadPlots(ids);
		}
		catch(e){}
		
		/** Loading attachments **/
		if (records.length == 1){
			var record = _this.getByAutoProcId(records[0].v_datacollection_summary_phasing_autoproc_autoprocId);
			if (record != null){
				_this.autoProcIntegrationAttachmentGrid.load(record);
			}
		}
		
		
		/** Loading phasing network **/
		var tmp = [].concat.apply([], _this.autoProcIntegrationPhasingViewList);
		var filtered = [];
		for ( i = 0; i &lt; tmp.length; i++) {
			if ( tmp[i].v_datacollection_summary_phasing_autoProcIntegrationId == records[0].v_datacollection_summary_phasing_autoProcIntegrationId){
				filtered.push( tmp[i]);
			}
		}
		
		_this.phasingNetworkWidget.load(tmp);
		
	});
	
	this.autoProcIntegrationAttachmentGrid = new AutoProcIntegrationAttachmentGrid({
																					width : this.slaveWidth, 
																					margin: 5
																					
	});
	
	/** Netowkrwidget for phasing **/
	this.phasingNetworkWidget = new PhasingNetworkWidget({tbar : &quot;OPEN_VIEWER&quot;});
	
	/** Curve completenessPlotter * */
	this.completenessPlotter = new AutoProcIntegrationCurvePlotter({
		height : 150,
		title : &quot;Completeness vs Resolution&quot;,
		legend : &#x27;never&#x27;
	});
	
	this.completenessPlotter.onPointClickCallback.attach(function(sender, id){
		_this.onPlotClicked(id);
	});
	
	this.rFactorPlotter = new AutoProcIntegrationCurvePlotter({
		height : 150,
		title : &quot;Rfactor vs Resolution&quot;,
		legend : &#x27;never&#x27;
	});
	
	this.rFactorPlotter.onPointClickCallback.attach(function(sender, id){
		_this.onPlotClicked(id);
	});
	
	this.isigmaPlotter = new AutoProcIntegrationCurvePlotter({
		height : 150,
		title : &quot;I/SigmaI vs Resolution&quot;,
		legend : &#x27;never&#x27;
	});

	this.isigmaPlotter.onPointClickCallback.attach(function(sender, id){
		_this.onPlotClicked(id);
	});
	
	this.cc2Plotter = new AutoProcIntegrationCurvePlotter({
		height : 150,
		title : &quot;CC/2 vs Resolution&quot;,
		legend : &#x27;never&#x27;
	});
	
	this.cc2Plotter.onPointClickCallback.attach(function(sender, id){
		_this.onPlotClicked(id);
	});
	
	this.sigmaAnnoPlotter = new AutoProcIntegrationCurvePlotter({
		height : 150,
		title : &quot;SigAno vs Resolution&quot;,
		legend : &#x27;never&#x27;
	});
	
	this.sigmaAnnoPlotter.onPointClickCallback.attach(function(sender, id){
		_this.onPlotClicked(id);
	});
	
	this.wilsonPlotter = new AutoProcIntegrationCurvePlotter({
		height : 150,
		title : &quot;Wilson Plot&quot;,
		legend : &#x27;never&#x27;
	});
	
	this.wilsonPlotter.onPointClickCallback.attach(function(sender, id){
		_this.onPlotClicked(id);
	});
	
	this.annoCorrPlotter = new AutoProcIntegrationCurvePlotter({
		height : 150,
		title : &quot;Anom Corr vs Resolution&quot;,
		legend : &#x27;never&#x27;
	});

	this.annoCorrPlotter.onPointClickCallback.attach(function(sender, id){
		_this.onPlotClicked(id);
	});
	
}

AutoProcIntegrationMainView.prototype.getPanel = MainView.prototype.getPanel;


AutoProcIntegrationMainView.prototype.getByAutoProcProgramAttachmentId = function(autoProcProgramAttachmentId) {
	for (var i = 0; i &lt; this.data.length; i++) {
		for (var j = 0; j &lt; this.data[i].autoprocprogram.attachmentVOs.length; j++) {
				var attachment = this.data[i].autoprocprogram.attachmentVOs[j];
				if (attachment.autoProcProgramAttachmentId == autoProcProgramAttachmentId){
					return this.data[i];
					
				} 
		}
	}
};



AutoProcIntegrationMainView.prototype.getByAutoProcId = function(autoProcId) {
	for (var i = 0; i &lt; this.data.length; i++) {
				if (this.data[i].autoproc.autoProcId == autoProcId){
					return this.data[i];
				} 
	}
};


AutoProcIntegrationMainView.prototype.onPlotClicked = function(autoProcProgramAttachmentId) {
	var record = this.getByAutoProcProgramAttachmentId(autoProcProgramAttachmentId);
	if (record != null){
		this.autoProcIntegrationGrid.selectRowByAutoProcIntegrationId(record.autointegration.autoProcIntegrationId);
	}
};

AutoProcIntegrationMainView.prototype.getPlotContainer = function(panel) {
	return {
  	  xtype : &#x27;container&#x27;,
	  margin : 5,
	  layout: {
	        	type: &#x27;fit&#x27;
	       },
	       flex :1,
	       items : [ 
	                	panel
	       ]
	  
  };
};


AutoProcIntegrationMainView.prototype.getAutoProcPanel = function() {
	return Ext.create(&#x27;Ext.container.Container&#x27;, {
		
		items : [ 
		         Ext.create(&#x27;Ext.container.Container&#x27;, {
		        	 layout: &#x27;hbox&#x27;, 
		        	 margin : &#x27;0 50 0 0&#x27;,
		        	 items : [
		        	          this.getPlotContainer( this.rFactorPlotter.getPanel())
		        	         
		        	 ]
		         }),
		         Ext.create(&#x27;Ext.container.Container&#x27;, {
		        	 layout: &#x27;hbox&#x27;, 
		        	 margin : &#x27;0 50 0 0&#x27;,
		        	 items : [
		        	          this.getPlotContainer( this.isigmaPlotter.getPanel())
		        	         
		        	 ]
		         }),
		         Ext.create(&#x27;Ext.container.Container&#x27;, {
		        	 layout: &#x27;hbox&#x27;, 
		        	 margin : &#x27;0 50 0 0&#x27;,
		        	 items : [
		        	          this.getPlotContainer( this.sigmaAnnoPlotter.getPanel()),
		        	         
		        	 ]
		         }),
		         Ext.create(&#x27;Ext.container.Container&#x27;, {
		        	 layout: &#x27;hbox&#x27;, 
		        	 margin : &#x27;0 50 0 0&#x27;,
		        	 items : [
		        	         
		        	          this.getPlotContainer( this.completenessPlotter.getPanel())
		        	          
		        	 ]
		         }),
		         Ext.create(&#x27;Ext.container.Container&#x27;, {
		        	 layout: &#x27;hbox&#x27;, 
		        	 margin : &#x27;0 50 0 0&#x27;,
		        	 items : [
		        	          this.getPlotContainer(this.annoCorrPlotter.getPanel())
		        	          
		        	 ]
		         }),
		         Ext.create(&#x27;Ext.container.Container&#x27;, {
		        	 layout: &#x27;hbox&#x27;, 
		        	 margin : &#x27;0 50 0 0&#x27;,
		        	 items : [
		        	          this.getPlotContainer( this.cc2Plotter.getPanel()),
		        	          
		        	 ]
		         })
		    ]
	});
};

AutoProcIntegrationMainView.prototype.getSlaveTabPanel = function() {
	return Ext.create(&#x27;Ext.tab.Panel&#x27;, {
		margin : &#x27;0 5 5 5&#x27;,
		cls : &#x27;border-grid&#x27;,
		width : this.slaveWidth,
	    items: [{
	        title: &#x27;Autoprocessing Plots&#x27;,
	        items :  this.getAutoProcPanel()
	    }, {
	        title: &#x27;Phasing&#x27;,
	        items : this.phasingNetworkWidget.getPanel()
	    }, {
	        title: &#x27;Files&#x27;,
	        items : this.autoProcIntegrationAttachmentGrid.getPanel()
	    }
	    
	    
	    ]
	}); 
};

AutoProcIntegrationMainView.prototype.getContainer = function() {
	return  Ext.createWidget(&#x27;panel&#x27;,
			{
				plain : true,
				margin : &#x27;10 30 10 10&#x27;,
				items : [
					{
							xtype : &#x27;container&#x27;,
							layout : &#x27;fit&#x27;,
							cls : &#x27;border-grid&#x27;,
							items : [ 
													Ext.create(&#x27;Ext.container.Container&#x27;, {
														 layout: &#x27;hbox&#x27;,
														 margin : &#x27;10 0 0 10&#x27;,
														 items : [
														          	this.autoProcIntegrationGrid.getPanel(),
														          	this.getSlaveTabPanel()
														          ]
													})
							          
							]
						}
				  ]
		});
};



AutoProcIntegrationMainView.prototype.loadPlots = function(autoProcIntegrationsIds) {
 	this.completenessPlotter.loadUrl(EXI.getDataAdapter().mx.autoproc.getXScaleCompleteness(autoProcIntegrationsIds.toString()));
	this.rFactorPlotter.loadUrl(EXI.getDataAdapter().mx.autoproc.getXScaleRfactor(autoProcIntegrationsIds.toString()));
	this.isigmaPlotter.loadUrl(EXI.getDataAdapter().mx.autoproc.getXScaleISigma(autoProcIntegrationsIds.toString()));
	this.cc2Plotter.loadUrl(EXI.getDataAdapter().mx.autoproc.getXScaleCC2(autoProcIntegrationsIds.toString()));
	this.sigmaAnnoPlotter.loadUrl(EXI.getDataAdapter().mx.autoproc.getXScaleSigmaAno(autoProcIntegrationsIds.toString()));
	this.annoCorrPlotter.loadUrl(EXI.getDataAdapter().mx.autoproc.getXScaleAnnoCorrection(autoProcIntegrationsIds.toString()));
};




	
AutoProcIntegrationMainView.prototype.load = function(dataCollectionId) {
	var _this = this;
	this.panel.setTitle(&quot;Autoprocessing&quot;);
	this.panel.setLoading(&quot;Generating plots&quot;);
	var onSuccess = function(sender, data){
		_this.data = data;
	};
	EXI.getDataAdapter({onSuccess : onSuccess}).mx.autoproc.getByDataCollectionId(dataCollectionId);
	
	var onSuccess2 = function(sender, data){
		
		data =  BUI.groupBy(data[0], function(item){
			  			return [item.v_datacollection_summary_phasing_autoProcIntegrationId];
		});
		var autoProcIntegrationIds = [];
		for (var i = 0; i &lt; data.length; i++) {
			autoProcIntegrationIds.push(data[i][0].v_datacollection_summary_phasing_autoProcIntegrationId);
		}
		_this.autoProcIntegrationPhasingViewList = data;
		
		_this.autoProcIntegrationGrid.load(data);
		_this.panel.setLoading(false);
		_this.loadPlots(autoProcIntegrationIds);
		_this.phasingNetworkWidget.load(data);
	};
	EXI.getDataAdapter({onSuccess : onSuccess2}).mx.phasing.getViewByDataCollectionId(dataCollectionId);
};



    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
