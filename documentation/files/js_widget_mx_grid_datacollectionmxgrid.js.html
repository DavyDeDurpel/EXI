<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/widget/mx/grid/datacollectionmxgrid.js - EXI</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EXI" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AutoProcIntegrationGrid.html">AutoProcIntegrationGrid</a></li>
                                <li><a href="../classes/ManagerWelcomeMainView.html">ManagerWelcomeMainView</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: js/widget/mx/grid/datacollectionmxgrid.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
function DataCollectionMxGrid(args) {

	var contextPath = &quot;&quot;;

	this.pageSize = 100;
	this.title = &quot;Last Data Collection&quot;;
	this.listOfCrystalClass = [];
	this.contextPath = &quot;&quot;;
	this.displayLastCollect = false;
	this.isManager = false;
	this.isIndustrial = false;
	this.pagingMode = false;
	this.groupFieldDefault = &#x27;&#x27;;
	this.setArgs(args);
	// Events
	this.onSaveButtonClicked = new Event(this);
	this.onPagingMode = new Event(this);
	this.onRankButtonClicked = new Event(this);
	this.onRankAutoProcButtonClicked = new Event(this);

	this.hideCol = true;
	this.rankEDNA = true;

	this.minDCId = 1;
	this.maxDCId = 0;
	
	this.rMergeCutoff = 10;
	this.iSigmaCutoff = 1;
	
	// dataCollection data model
	Ext.define(&#x27;DataCollectionModel&#x27;, {
			extend : &#x27;Ext.data.Model&#x27;,
			fields : [{
					name : &#x27;dataCollectionId&#x27;,
					mapping : &#x27;dataCollectionId&#x27;
				}, {
					name : &#x27;experimentType&#x27;,
					mapping : &#x27;experimentType&#x27;
				}, {
					name : &#x27;startTime&#x27;,
					mapping : &#x27;startTime&#x27;,
					type : &#x27;date&#x27;,
					dateFormat : &#x27;d-m-Y H:i:s&#x27;
				}, {
				    name : &#x27;endTime&#x27;,
					mapping : &#x27;endTime&#x27;,
					type : &#x27;date&#x27;,
					dateFormat : &#x27;d-m-Y H:i:s&#x27;
				}, {
					name : &#x27;beamLineName&#x27;,
					mapping : &#x27;beamLineName&#x27;
				}, {
					name : &#x27;proposal&#x27;,
					mapping : &#x27;proposal&#x27;
				}, {
					name : &#x27;login&#x27;,
					mapping : &#x27;login&#x27;		
				}, {
					name : &#x27;imagePrefix&#x27;,
					mapping : &#x27;imagePrefix&#x27;
				}, {
					name : &#x27;dataCollectionNumber&#x27;,
					mapping : &#x27;dataCollectionNumber&#x27;
				}, {
					name : &#x27;proteinAcronym&#x27;,
					mapping : &#x27;proteinAcronym&#x27;
				}, {
					name : &#x27;pdbFileName&#x27;,
					mapping : &#x27;pdbFileName&#x27;
				}, {
					name : &#x27;numberOfImages&#x27;,
					mapping : &#x27;numberOfImages&#x27;
				}, {
					name : &#x27;hasSnapshot&#x27;,
					mapping : &#x27;hasSnapshot&#x27;
				}, {
					name : &#x27;runStatus&#x27;,
					mapping : &#x27;runStatus&#x27;
				}, {
					name : &#x27;autoProc&#x27;,
					mapping : &#x27;autoProc&#x27;
				}, {
					name : &#x27;autoProcStatisticsOverall&#x27;,
					mapping : &#x27;autoProcStatisticsOverall&#x27;
				}, {
					name : &#x27;autoProcStatisticsInner&#x27;,
					mapping : &#x27;autoProcStatisticsInner&#x27;
				}, {
					name : &#x27;autoProcStatisticsOuter&#x27;,
					mapping : &#x27;autoProcStatisticsOuter&#x27;
				}, {
					name : &#x27;screeningOutput&#x27;,
					mapping : &#x27;screeningOutput&#x27;
				}, {
					name : &#x27;lattice&#x27;,
					mapping : &#x27;lattice&#x27;
				}, {
					name : &#x27;comments&#x27;,
					mapping : &#x27;comments&#x27;
				}, {
					name : &#x27;autoprocessingStatus&#x27;,
					mapping : &#x27;autoprocessingStatus&#x27;
				}, {
					name : &#x27;autoprocessingStep&#x27;,
					mapping : &#x27;autoprocessingStep&#x27;
				}, {
					name : &#x27;wavelength&#x27;,
					mapping : &#x27;wavelength&#x27;
				}, {
					name : &#x27;transmission&#x27;,
					mapping : &#x27;transmission&#x27;
				}, {
					name : &#x27;exposureTime&#x27;,
					mapping : &#x27;exposureTime&#x27;
				}, {
					name : &#x27;axisStart&#x27;,
					mapping : &#x27;axisStart&#x27;
				}, {
					name : &#x27;axisRange&#x27;,
					mapping : &#x27;axisRange&#x27;
				}, {
					name : &#x27;resolution&#x27;,
					mapping : &#x27;resolution&#x27;
				}, {
					name : &#x27;transmission&#x27;,
					mapping : &#x27;transmission&#x27;
				}, {
					name : &#x27;hasAutoProcAttachment&#x27;,
					mapping : &#x27;hasAutoProcAttachment&#x27;
				}, {
					name : &#x27;printableForReport&#x27;,
					mapping : &#x27;printableForReport&#x27;
				}, {
					name : &#x27;skipForReport&#x27;,
					mapping : &#x27;skipForReport&#x27;
				}],
			idProperty : &#x27;dataCollectionId&#x27;
		});
}

// args passed to the constructor
DataCollectionMxGrid.prototype.setArgs = function (args) {
	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.contextPath != null) {
			this.contextPath = args.contextPath;
		}
		if (args.title != null) {
			this.title = args.title;
		}
		if (args.listOfCrystalClass != null) {
			this.listOfCrystalClass = args.listOfCrystalClass;
		}
		if (args.contextPath != null) {
			this.contextPath = args.contextPath;
		}
		if (args.displayLastCollect != null) {
			this.displayLastCollect = args.displayLastCollect;
		}
		if (args.isManager != null) {
			this.isManager = args.isManager;
		}
		if (args.pagingMode != null) {
			this.pagingMode = args.pagingMode;
		}
		if (args.isIndustrial != null) {
			this.isIndustrial = args.isIndustrial;
		}
		if (args.groupFieldDefault != null) {
			this.groupFieldDefault = args.groupFieldDefault;
		}
		if (args.iSigmaCutoff != null) {
			this.iSigmaCutoff = args.iSigmaCutoff;
		}
		if (args.rMergeCutoff != null) {
			this.rMergeCutoff = args.rMergeCutoff;
		}
		
	}
};

// sort by default
DataCollectionMxGrid.prototype._sort = function () {
	this.store.sort(&#x27;startTime&#x27;, &#x27;DESC&#x27;);
};


// get grids
DataCollectionMxGrid.prototype.getGrid = function (dataCollections) {
	this.features = dataCollections;
	return this.renderGrid(dataCollections);
};

// refresh data: reload
DataCollectionMxGrid.prototype.refresh = function (data) {
	this.features = data.dataCollectionList;
	this.store.loadData(this.features, false);
	this.title = &quot;Last &quot; + this.features.length + &quot; DataCollections&quot;;
	this.grid.setTitle(this.title);
};

// build the grid
DataCollectionMxGrid.prototype.getPanel = function () {
	this.features = [];
	var _this = this;
	// min &amp; max ID collect
	if (this.features &amp;&amp; this.features.length &gt; 0) {
		this.minDCId = this.features[0].dataCollectionId;
		this.maxDCId = this.features[0].dataCollectionId;
		var fl = this.features.length;
		for (var i = 0; i &lt; fl; i++) {
			var id = this.features[i].dataCollectionId;
			if (id &gt; this.maxDCId) {
				this.maxDCId = id;
			}
			if (id &lt; this.minDCId) { 
				this.minDCId = id;
			}
		}
	}
	/** Prepare data * */
	var data = [];
	// build columns
	var columns = this._getColumns();
	
	
	// grid data
	if (this.pagingMode) {
		this.store = Ext.create(&#x27;Ext.data.Store&#x27;, {
				model : &#x27;DataCollectionModel&#x27;,
				autoload : false,
				pageSize : this.pageSize,
				proxy : {
					type : &#x27;pagingmemory&#x27;,
					data : this.features,
					reader : {
						type : &#x27;array&#x27;
					}
				}
			});
	} else if (_this.groupFieldDefault) {
		this.store = Ext.create(&#x27;Ext.data.Store&#x27;, {
				model : &#x27;DataCollectionModel&#x27;,
				autoload : false,
				groupField: _this.groupFieldDefault
			});
	} else {
		this.store = Ext.create(&#x27;Ext.data.Store&#x27;, {
			model : &#x27;DataCollectionModel&#x27;,
			autoload: false
		});
	}
	
	// bottom bar
	var bbar = null;
	var pagingButtonText = &quot;Pagination&quot;;
	if (this.pagingMode) {
		pagingButtonText = &quot;Remove pagination&quot;;
		bbar = Ext.create(&#x27;Ext.PagingToolbar&#x27;, {
				store : this.store,
				pageSize : this.pageSize,
				displayInfo : true,
				displayMsg : &#x27;Displaying dataCollections {0} - {1} of {2}&#x27;,
				emptyMsg : &quot;No dataCollection to display&quot;,
				listeners : {
					afterrender : function () {
						var a = Ext.query(&quot;button[data-qtip=Refresh]&quot;);
						for (var x = 0; x &lt; a.length; x++) {
							a[x].style.display = &quot;none&quot;;
						}
					}
				}
			});

	}

	// this._sort(this.store);
	this.store.loadData(this.features, false);
	// set title
	if (this.displayLastCollect) {
		this.title = &quot;Last &quot; + this.features.length + &quot; DataCollections&quot;;
	} else {
		this.title = this.features.length + &quot; DataCollections&quot;;
	}

	// this grid can be edited
	var cellEditing = Ext.create(&#x27;Ext.grid.plugin.CellEditing&#x27;, {
			clicksToEdit : 1
		});

	// grouping grid
	_this.groupingFeature = Ext.create(&#x27;Ext.grid.feature.Grouping&#x27;, {
		groupHeaderTpl : &#x27;{columnName}: {name} ({rows.length} Item{[values.rows.length &gt; 1 ? &quot;s&quot; : &quot;&quot;]})&#x27;,
		hideGroupedHeader : true,
		startCollapsed : false,
		id : &#x27;dataCollectionGrouping&#x27;
	});
	var groups = []; //this.store.getGroups();
	var len = groups.length;
	var toggleGroup = function (item) {
		var groupName = item.text;
		if (item.checked) {
			_this.groupingFeature.expand(groupName, true);
		} else {
			_this.groupingFeature.collapse(groupName, true);
		}
	};

	// Define the model for a rank
//	Ext.regModel(&#x27;Rank&#x27;, {
//			fields : [{
//					type : &#x27;string&#x27;,
//					name : &#x27;name&#x27;
//				}]
//		});
//	var ranks = [{
//			&quot;name&quot; : &quot;EDNA&quot;
//		}, {
//			&quot;name&quot; : &quot;AutoProc&quot;
//		}];
	// The data store holding the ranks
//	var rankStore = Ext.create(&#x27;Ext.data.Store&#x27;, {
//			model : &#x27;Rank&#x27;,
//			data : ranks
//		});

	// Simple ComboBox using the data store
	var rankCombo = Ext.create(&#x27;Ext.form.field.ComboBox&#x27;, {
			displayField : &#x27;name&#x27;,
			width : 100,
			labelWidth : 10,
//			store : rankStore,
			queryMode : &#x27;local&#x27;,
			typeAhead : true,
			forceSelection : true,
			value : &#x27;EDNA&#x27;,
			listeners : {
				change : function (field, newValue, oldValue) {
					_this.changeRank();
				}
			}
		});

	// top bar with buttons
	var tbar = [];
	if (!this.displayLastCollect) {
		tbar.push({
				text : &#x27;Save&#x27;,
				tooltip : &#x27;Save dataCollections: comments and skip status&#x27;,
				icon : &#x27;../images/save.gif&#x27;,
				handler : function () {
					_this.onSaveButtonClicked.notify({});
				}
			});
		tbar.push({
				text : &#x27;Experiment Parameters&#x27;,
				tooltip : &#x27;Expand or Collapse Experiment Parameter&#x27;,
				icon : &#x27;../images/Info_16x16_01.png&#x27;,
				handler : function () {
					_this.hideAndShowExperimentParameter();
				}
			});
		tbar.push({
				text : &#x27;Rank&#x27;,
				tooltip : &#x27;Start Sample Ranking&#x27;,
				handler : function () {
					_this.startRank();
				}
			}, rankCombo);
	}

	if (this.displayLastCollect) {
		tbar.push({
				text : pagingButtonText,
				handler : function () {
					_this.onPagingMode.notify();
				}
			});
	}
	tbar.push(&#x27;-&gt;&#x27;);
	tbar.push({
		text : &#x27;Expand All&#x27;,
		handler : function () {
			var rows = _this.groupingFeature.view.getEl().query(&#x27;.x-grid-group-body&#x27;);

			Ext.each(rows, function (row) {
						_this.groupingFeature.expand(Ext.get(row));
					});
		}
	}, {
		text : &#x27;Collapse All&#x27;,
		handler : function () {
			var rows = _this.groupingFeature.view.getEl().query(&#x27;.x-grid-group-body&#x27;);

			Ext.each(rows, function (row) {
						_this.groupingFeature.collapse(Ext.get(row));
					});
		}
	});
	tbar.push({
			text : &#x27;Clear Grouping&#x27;,
			iconCls : &#x27;icon-clear-group&#x27;,
			handler : function () {
				_this.groupingFeature.disable();
			}
		});

	// Ext.state.Manager.setProvider(new Ext.state.CookieProvider());
	
	// grid creation
	this.grid = Ext.create(&#x27;Ext.grid.Panel&#x27;, {
		style : {
			padding : 0
		},
		width : &quot;100%&quot;,
		height : &quot;100%&quot;,
		model : &#x27;DataCollectionModel&#x27;,
		store : this.store,
		resizable : true,
		//height:800,
		columns : columns,
		title : this.title,
		viewConfig : {
			stripeRows : true,
			enableTextSelection : true
		},
		selModel : {
			mode : &#x27;SINGLE&#x27;
		},
		plugins : [cellEditing],
		features : [_this.groupingFeature],

		tbar : tbar,
		// paging bar on the bottom
		bbar : bbar
			// stateId: &quot;DataCollectionMxGridStateId&quot;, // this is unique state ID
			// stateful: true, // state should be preserved
			// stateEvents: [&#x27;columnresize&#x27;, &#x27;columnmove&#x27;, &#x27;show&#x27;, &#x27;hide&#x27; ] //
			// which event should cause store state
	});
	if (this.pagingMode) {
		this.store.load();
	}
	// hideCol
	// this._hideCol();
	//this._sort(this.store);
	return this.grid;
};

// returns the index of the column, -1 if not found
DataCollectionMxGrid.prototype._getIndex = function (dataIndex) {
	var gridColumns = this.grid.columns;
	var gl = gridColumns.length;
	for (var i = 0; i &lt; gl; i++) {
		if (gridColumns[i].dataIndex == dataIndex) {
			return i;
		}
	}
	return -1;
};

// hide the columns experiments
DataCollectionMxGrid.prototype._hideCol = function () {
	if (!this.displayLastCollect) {
		var id = this._getIndex(&quot;experimentParameters&quot;);
		if (id != -1) {
			this.grid.columns[id].setVisible(this.hideCol);
		}
		// We use &#x27;Wavelength&#x27; and &#x27;Detector Resolution&#x27; as start and stop
		// points and hide everything in between.
		var id0 = this._getIndex(&quot;wavelength&quot;);
		var id1 = this._getIndex(&quot;resolution&quot;);
		if (id0 != -1 &amp;&amp; id1 != -1) {
			var nb = id1 - id0 + 1;
			for (var i = 0; i &lt; nb; i++) {
				this.grid.columns[id0 + i].setVisible(!this.hideCol);
			}
		}
	}
};

// build the columns
DataCollectionMxGrid.prototype._getColumns = function () {
	var _this = this;
	// render functions
	
	// render date
	function renderStartDate(value, p, record) {
		var time = Ext.Date.format(value, &#x27;H:i:s&#x27;);
		var date = Ext.Date.format(value, &#x27;d-m-Y&#x27;);
		return time + &quot;&lt;br /&gt;&quot; + date;
	}

	// render image prefix with link
	function renderImagePrefix(value, p, record) {
		return &#x27;&lt;div style=&quot;white-space:normal !important;word-wrap: break-word&quot;&gt;&#x27; + &#x27;&lt;a href=&quot;&#x27; +
		 _this.contextPath +
		&#x27;/user/viewResults.do?reqCode=display&amp;dataCollectionId=&#x27; + 
		record.getId() + &#x27;&quot;&gt;&#x27; + value + &#x27;&lt;/a&gt;&#x27; + &#x27;&lt;/div&gt;&#x27;;
	}

	// render protein acronym
	function renderProteinAcronym(value, p, record) {
		if (record.data.pdbFileName &amp;&amp; record.data.pdbFileName !== &quot;&quot;) {
			p.tdAttr = &#x27;data-qtip=&quot;&#x27; + 
			(&quot;pdb file uploaded:&quot; + record.data.pdbFileName) + &#x27;&quot;&#x27;;
			return &quot;&lt;img src=&#x27;../images/attach.png&#x27; border=&#x27;0&#x27;  /&gt;&quot; + value;
		} else {
			return value;
		}
	}

	// format nb with 2 digits
	function renderFixed2(value, p, record) {
		if (value) { 
			return value.toFixed(2);
		}
		else {
			return &quot;&quot;;
		}
	}

	// format nb with 3 digits
	function renderFixed3(value, p, record) {
		if (value) { 
			return value.toFixed(3);
		}
		else { 
			return &quot;&quot;;
		}
	}

	// return the message for status
	function statusPopup(icon1, mess1, icon2, mess2, icon3, mess3, icon4, mess4) {
		var popupMessage = &quot;&quot;;
		popupMessage += &quot;&lt;TABLE cellSpacing=2 cellPadding=0 width=100% border=0&gt;&quot;;
		popupMessage += &quot;&lt;TR&gt;&lt;TD valign=middle&gt;&lt;img src=&#x27;&quot; + icon1 +
			&quot;&#x27; border=0\/&gt;&lt;\/TD&gt;&lt;TD class=&#x27;smallText_black&#x27; nowrap&gt;&quot; + mess1 + &quot;&lt;\/TD&gt;&lt;\/TR&gt;&quot;;
		popupMessage += &quot;&lt;TR&gt;&lt;TD valign=middle&gt;&lt;img src=&#x27;&quot; + icon2 +
			&quot;&#x27; border=0\/&gt;&lt;\/TD&gt;&lt;TD class=&#x27;smallText_black&#x27; nowrap&gt;&quot; + mess2 + &quot;&lt;\/TD&gt;&lt;\/TR&gt;&quot;;
		popupMessage += &quot;&lt;TR&gt;&lt;TD valign=middle&gt;&lt;img src=&#x27;&quot; + icon3 +
			&quot;&#x27; border=0\/&gt;&lt;\/TD&gt;&lt;TD class=&#x27;smallText_black&#x27; nowrap&gt;&quot; + mess3 + &quot;&lt;\/TD&gt;&lt;\/TR&gt;&quot;;
		popupMessage += &quot;&lt;TR&gt;&lt;TD valign=middle&gt;&lt;img src=&#x27;&quot; + icon4 +
		&quot;&#x27; border=0\/&gt;&lt;\/TD&gt;&lt;TD class=&#x27;smallText_black&#x27; nowrap&gt;&quot; + mess4 + &quot;&lt;\/TD&gt;&lt;\/TR&gt;&quot;;
		popupMessage += &quot;&lt;\/TABLE&gt;&quot;;
		return popupMessage;
	}
	
	// render status with balls
	function renderStatus(value, p, record) {
		var icon1 = &#x27;../images/Sphere_White_12.png&#x27;;
		var icon2 = &#x27;../images/Sphere_White_12.png&#x27;;
		var icon3 = &#x27;../images/Sphere_White_12.png&#x27;;
		var icon4 = &#x27;../images/Sphere_White_12.png&#x27;;
		var mess1 = &quot;&quot;;
		var mess2 = &quot;&quot;;
		var mess3 = &quot;&quot;;
		var mess4 = &quot;&quot;;

		// crystal snapshot
		if (record.data.hasSnapshot &amp;&amp; record.data.hasSnapshot) {
			icon1 = &quot;../images/Sphere_Green_12.png&quot;;
			mess1 = &quot;This collection has a crystal snapshot.&quot;;
		} else {
			icon1 = &quot;../images/Sphere_White_12.png&quot;;
			mess1 = &quot;This collection has no crystal snapshot.&quot;;
		}
		// run status
		if (record.data.runStatus) {
			mess2 = record.data.runStatus;
			if (record.data.runStatus.search(&quot;successful&quot;) != -1) {
				icon2 = &quot;../images/Sphere_Green_12.png&quot;;
			} else if (record.data.runStatus.search(&quot;failed&quot;) != -1) {
				icon2 = &quot;../images/Sphere_Red_12.png&quot;;
			} else if (record.data.runStatus.search(&quot;Running&quot;) != -1) {
				icon2 = &quot;../images/Sphere_Orange_12.png&quot;;
			} else {
				icon2 = &quot;../images/Sphere_Yelow_12.png&quot;;
			}
		}
		// EDNA status
		if (record.data.screeningOutput) {
			if (record.data.screeningOutput.indexingSuccess) {
				if (record.data.screeningOutput.strategySuccess) {
					if (record.data.screeningOutput.indexingSuccess == 1) {
						if (record.data.screeningOutput.strategySuccess == 1) {
							icon3 = &quot;../images/Sphere_Green_12.png&quot;;
							mess3 = &quot;Indexing is successful.&quot;;
						} else {
							icon3 = &quot;../images/Sphere_Orange_12.png&quot;;
							mess3 = &quot;Indexing is successful but no strategy.&quot;;
						}
					} else {
						icon3 = &quot;../images/Sphere_Red_12.png&quot;;
						mess3 = &quot;Indexing failed.&quot;;
					}
				} else {
					icon3 = &quot;../images/Sphere_Yelow_12.png&quot;;
					mess3 = &quot;Indexing status unknown.&quot;;
				}
			} else {
				icon3 = &quot;../images/Sphere_Yelow_12.png&quot;;
				mess3 = &quot;Indexing status unknown.&quot;;
			}
		} else {
			icon3 = &quot;../images/Sphere_White_12.png&quot;;
			mess3 = &quot;Indexing has not been launched.&quot;;
		}
		// Autoprocessing status
		if (record.data.autoprocessingStatus) {
			if (record.data.autoprocessingStatus == &quot;Successful&quot;) {
				icon4 = &quot;../images/Sphere_Green_12.png&quot;;
				mess4 = &quot;Autoprocessing: &quot; + record.data.autoprocessingStep + &quot; Successful&quot;;
			} else if (record.data.autoprocessingStatus == &quot;Launched&quot;) {
				icon4 = &quot;../images/Sphere_Orange_12.png&quot;;
				mess4 = &quot;Autoprocessing: &quot; + record.data.autoprocessingStep + &quot; Launched&quot;;
			} else if (record.data.autoprocessingStatus == &quot;Failed&quot;) {
				icon4 = &quot;../images/Sphere_Red_12.png&quot;;
				mess4 = &quot;Autoprocessing: &quot; + record.data.autoprocessingStep + &quot; Failed&quot;;
			}
		} else {
			icon4 = &quot;../images/Sphere_White_12.png&quot;;
			mess4 = &quot;Autoprocessing status unknown.&quot;;
		}
		//
		var myToolTipText = statusPopup(icon1, mess1, icon2, mess2, icon3,
				mess3, icon4, mess4);
		p.tdAttr = &#x27;data-qtip=&quot;&#x27; + myToolTipText + &#x27;&quot;&#x27;;
		return &quot;&lt;img src=&#x27;&quot; + icon1 + &quot;&#x27; border=0&gt;&quot; + &quot;&lt;img src=&#x27;&quot; + icon2 + &quot;&#x27; border=0&gt;&quot; + &quot;&lt;img src=&#x27;&quot; + icon3 + &quot;&#x27; border=0&gt;&quot; +
		&quot;&lt;img src=&#x27;&quot; + icon4 + &quot;&#x27; border=0&gt;&quot;;
	}

	// render completeness
	function renderCompleteness(value, p, record) {
		if (record.data.autoProcStatisticsOverall &amp;&amp; record.data.autoProcStatisticsOuter &amp;&amp; record.data.autoProcStatisticsInner) {
			var percentage1 = record.data.autoProcStatisticsInner.completeness;
			var percentage2 = record.data.autoProcStatisticsOuter.completeness;
			var percentage3 = record.data.autoProcStatisticsOverall.completeness;

			var initial = -61;
			var imageWidth = 122;
			var eachPercent = (imageWidth / 2) / 100;

			var percentageWidth1 = eachPercent * percentage1;
			var actualWidth1 = initial + percentageWidth1;
			var colour1 = percentage1 &lt; 85 ? 4 : 1;

			var percentageWidth2 = eachPercent * percentage2;
			var actualWidth2 = initial + percentageWidth2;
			var colour2 = percentage2 &lt; 85 ? 4 : 1;

			var percentageWidth3 = eachPercent * percentage3;
			var actualWidth3 = initial + percentageWidth3;
			var colour3 = percentage3 &lt; 85 ? 4 : 1;

			var s = &quot;&quot;;
			if (!(percentage1 === 0 &amp;&amp; percentage2 === 0 &amp;&amp; percentage3 === 0)) {
				s += &#x27;&lt;img &quot; src=&quot;../images/percentImage_small.png&quot; title=&quot;&#x27; +
						percentage1 + &#x27;% (inner)&quot; alt=&quot;&#x27; + percentage1 +
						&#x27;% (inner)&quot; class=&quot;percentImage&#x27; + colour1 +
						&#x27;&quot; style=&quot;background-position: &#x27; + actualWidth1 +
						&#x27;px 0pt; &quot;/&gt;&lt;br/&gt;&#x27;;
				s += &#x27;&lt;img  src=&quot;../images/percentImage_small.png&quot; title=&quot;&#x27; + 
						percentage2 + &#x27;% (outer)&quot; alt=&quot;&#x27; + percentage2 + 
						&#x27;% (outer)&quot; class=&quot;percentImage&#x27; + colour2 + 
						&#x27;&quot; style=&quot;background-position: &#x27; + actualWidth2 + 
						&#x27;px 0pt; &quot;/&gt;&lt;br/&gt;&#x27;;
				s += &#x27;&lt;img  src=&quot;../images/percentImage_small.png&quot; title=&quot;&#x27; + 
						percentage3 + &#x27;% (overall)&quot; alt=&quot;&#x27; + percentage3 + 
						&#x27;% (overall)&quot; class=&quot;percentImage&#x27; + colour3 + 
						&#x27;&quot; style=&quot;background-position: &#x27; + actualWidth3 + 
						&#x27;px 0pt; &quot;/&gt;&lt;br/&gt;&#x27;;
			}
			return s;
		}
		return &quot;&quot;;
	}

	// render resolution
	function renderResolution(value, p, record) {
		if (record.data.autoProcStatisticsOverall &amp;&amp; record.data.autoProcStatisticsOuter &amp;&amp; record.data.autoProcStatisticsInner) {
			var s = (record.data.autoProcStatisticsInner.resolutionLimitLow ? record.data.autoProcStatisticsInner.resolutionLimitLow : &quot;&quot;) + 
					&quot; - &quot; +
					(record.data.autoProcStatisticsInner.resolutionLimitHigh ? record.data.autoProcStatisticsInner.resolutionLimitHigh : &quot;&quot;) + &quot;&lt;br /&gt;&quot;;
			s += (record.data.autoProcStatisticsOuter.resolutionLimitLow ? record.data.autoProcStatisticsOuter.resolutionLimitLow : &quot;&quot;) +
					&quot; - &quot; +
					(record.data.autoProcStatisticsOuter.resolutionLimitHigh ? record.data.autoProcStatisticsOuter.resolutionLimitHigh : &quot;&quot;) + &quot;&lt;br /&gt;&quot;;
			s += (record.data.autoProcStatisticsOverall.resolutionLimitLow ? record.data.autoProcStatisticsOverall.resolutionLimitLow : &quot;&quot;) +
					&quot; - &quot; +
					(record.data.autoProcStatisticsOverall.resolutionLimitHigh ? record.data.autoProcStatisticsOverall.resolutionLimitHigh : &quot;&quot;) + &quot;&lt;br /&gt;&quot;;
			return s;
		} else if (record.data.screeningOutput) {
			return Number(record.data.screeningOutput.rankingResolution)
					.toFixed(2);
		}
		return &quot;&quot;;
	}

	// render rsymm
	function renderRsymm(value, p, record) {
		if (record.data.autoProcStatisticsOverall &amp;&amp; record.data.autoProcStatisticsOuter &amp;&amp; record.data.autoProcStatisticsInner) {
			var s = (record.data.autoProcStatisticsInner.rmerge ? Number(record.data.autoProcStatisticsInner.rmerge).toFixed(1): &quot;&quot;) + &quot;&lt;br /&gt;&quot;;
			s += (record.data.autoProcStatisticsOuter.rmerge ? Number(record.data.autoProcStatisticsOuter.rmerge).toFixed(1) : &quot;&quot;) + &quot;&lt;br /&gt;&quot;;
			s += (record.data.autoProcStatisticsOverall.rmerge ? Number(record.data.autoProcStatisticsOverall.rmerge).toFixed(1): &quot;&quot;) + &quot;&lt;br /&gt;&quot;;
			return s;
		}
		return &quot;&quot;;
	}

	// render unit cell
	function renderUnitCell(value, p, record) {
		var nbDec = 2;
		if (record.data.autoProc) {
			var s = (record.data.autoProc.refinedCellA ? Number(record.data.autoProc.refinedCellA).toFixed(nbDec) + &quot;, &quot; : &quot;&quot;);
			s += (record.data.autoProc.refinedCellB ? Number(record.data.autoProc.refinedCellB).toFixed(nbDec) + &quot;, &quot;: &quot;&quot;);
			s += (record.data.autoProc.refinedCellC ? Number(record.data.autoProc.refinedCellC).toFixed(nbDec) + &quot;&lt;br /&gt;&quot;: &quot;&quot;);
			s += (record.data.autoProc.refinedCellAlpha ? Number(record.data.autoProc.refinedCellAlpha).toFixed(nbDec) + &quot;, &quot; : &quot;&quot;);
			s += (record.data.autoProc.refinedCellBeta ? Number(record.data.autoProc.refinedCellBeta).toFixed(nbDec) + &quot;, &quot; : &quot;&quot;);
			s += (record.data.autoProc.refinedCellGamma ? Number(record.data.autoProc.refinedCellGamma).toFixed(nbDec): &quot;&quot;);
			return s;
		} else if (record.data.lattice) {
			var s1 = (record.data.lattice.unitCell_a ? Number(record.data.lattice.unitCell_a).toFixed(nbDec) + &quot;, &quot;: &quot;&quot;);
			s1 += (record.data.lattice.unitCell_b ? Number(record.data.lattice.unitCell_b).toFixed(nbDec) + &quot;, &quot;: &quot;&quot;);
			s1 += (record.data.lattice.unitCell_c ? Number(record.data.lattice.unitCell_c).toFixed(nbDec) + &quot;&lt;br /&gt;&quot;: &quot;&quot;);
			s1 += (record.data.lattice.unitCell_alpha ? Number(record.data.lattice.unitCell_alpha).toFixed(nbDec) + &quot;, &quot;: &quot;&quot;);
			s1 += (record.data.lattice.unitCell_beta ? Number(record.data.lattice.unitCell_beta).toFixed(nbDec) + &quot;, &quot;: &quot;&quot;);
			s1 += (record.data.lattice.unitCell_gamma ? Number(record.data.lattice.unitCell_gamma).toFixed(nbDec) : &quot;&quot;);
			return s1;
		}
		return &quot;&quot;;
	}

	// render spaceGroup, edna or autoProc
	function renderSpaceGroup(value, p, record) {
		if (record.data.autoProc) {
			return record.data.autoProc.spaceGroup;
		} else {
			// edna space group
			if (record.data.lattice) {
				return record.data.lattice.spaceGroup;
			} else {
				return &quot;&quot;;
			}
		}
	}

	// column wrap
	function columnWrap(value) {
		if (value) { 
			return &#x27;&lt;div style=&quot;white-space:normal !important;&quot;&gt;&#x27; + value + &#x27;&lt;/div&gt;&#x27;;
		}
		else { 
			return  &quot;&quot;;
		}
	}

	// render experiment parameters (col hidden or expanded)
	function renderExperimentParameter(value, p, record) {
		var icon = &#x27;../images/Info_16x16_01.png&#x27;;
		var myToolTipText = &quot;&quot;;
		myToolTipText += &quot;Wavelength: &quot; + (record.data.wavelength ? record.data.wavelength.toFixed(3): &quot;&quot;);
		myToolTipText += &quot;&lt;br/&gt;&quot;;
		myToolTipText += &quot;Transmission: &quot; + (record.data.transmission ? record.data.transmission.toFixed(3) : &quot;&quot;);
		myToolTipText += &quot;&lt;br/&gt;&quot;;
		myToolTipText += &quot;ex. Time: &quot; + (record.data.exposureTime ? record.data.exposureTime.toFixed(2) : &quot;&quot;);
		myToolTipText += &quot;&lt;br/&gt;&quot;;
		myToolTipText += &quot;PhiStart: &quot; + (record.data.axisStart ? record.data.axisStart.toFixed(2): &quot;&quot;);
		myToolTipText += &quot;&lt;br/&gt;&quot;;
		myToolTipText += &quot;PhiRange: &quot; + (record.data.axisRange ? record.data.axisRange.toFixed(2): &quot;&quot;);
		myToolTipText += &quot;&lt;br/&gt;&quot;;
		myToolTipText += &quot;Detector Resolution: &quot; + (record.data.resolution ? record.data.resolution.toFixed(2): &quot;&quot;);
		p.tdAttr = &#x27;data-qtip=&quot;&#x27; + myToolTipText + &#x27;&quot;&#x27;;
		return &quot;&lt;img src=&#x27;&quot; + icon + &quot;&#x27; border=0&gt;&quot;;
	}

	// render Rank Column
	function renderCheckBoxRank(value, p, record) {
		var ednaChecked = false;
		var autoProcChecked = false;
		if (record.data.screeningOutput) {
			if (record.data.screeningOutput.indexingSuccess) {
				if (record.data.screeningOutput.strategySuccess) {
					if (record.data.screeningOutput.indexingSuccess == 1) {
						ednaChecked = true;
					}
				}
			}
		} else if (record.data.autoProc) {
			autoProcChecked = true;
		}
		var s = &quot;&quot;;
		if (ednaChecked) {
			s += &quot;&lt;input checked=&#x27;&quot; + ednaChecked + &quot;&#x27; name=&#x27;rankIdList[&quot; + 
					record.data.dataCollectionId + 
					&quot;]&#x27; value=&#x27;on&#x27; type=&#x27;checkbox&#x27;&gt;&quot;;
			s += &quot;&lt;img  src=&#x27;../images/checkbox_grey.png&#x27; id=&#x27;rankIdImage[&quot; + 
					record.data.dataCollectionId + &quot;]&#x27; style=&#x27;display:none&#x27;&gt;&quot;;
		}
		if (autoProcChecked) {
			s += &quot;&lt;input checked=&#x27;&quot; + autoProcChecked + 
					&quot;&#x27; name=&#x27;rankIdAutoProcList[&quot; + 
					record.data.dataCollectionId + 
					&quot;]&#x27; value=&#x27;on&#x27; type=&#x27;checkbox&#x27; style=&#x27;display:none&#x27;&gt;&quot;;
			s += &quot;&lt;img  src=&#x27;../images/checkbox_grey.png&#x27; id=&#x27;rankIdAutoProcImage[&quot; + 
					record.data.dataCollectionId + &quot;]&#x27; style=&#x27;display:none&#x27;&gt;&quot;;
		}
		if (!ednaChecked &amp;&amp; !autoProcChecked) { 
			return &quot;&lt;img src=&#x27;../images/checkbox_grey.png&#x27; border=0&gt;&quot;;
		}
		else { 
			return s;
		}
	}
	
	// render Skip
	function renderCheckBoxSkip(value, p, record) {
		var s = &quot;&lt;input &quot; + (value ? &quot;checked=&#x27;checked&#x27;&quot; : &quot;&quot;) + &quot; property=&#x27;skipIdList[&quot; + 
					record.data.dataCollectionId + 
					&quot;]&#x27;  value=&#x27;1&#x27; type=&#x27;checkbox&#x27;&gt;&quot;;						
		return s;		
	}
	
	// hide element
	function actionItemRenderer(value, meta, record, rowIx, ColIx, store) {
		if (!record.get(&#x27;hasAutoProcAttachment&#x27;)) {
			return &#x27;x-hide-display&#x27;;
		}
	}

	// build columns
	var columns = [];
	if (this.displayLastCollect) {
		columns.push({
				text : &#x27;Beamline&lt;br/&gt;Name&#x27;,
				dataIndex : &#x27;beamLineName&#x27;,
				flex : 0.08,
				id : &#x27;beamLineName&#x27;
			});
	}
	if (this.isManager) {
		columns.push({
				text : &#x27;Proposal&#x27;,
				dataIndex : &#x27;proposal&#x27;,
				flex : 0.1,
				id : &#x27;proposal&#x27;
			});
	}
    if (this.isManager) {
        columns.push({
                        text : &#x27;User&#x27;,
                        dataIndex : &#x27;login&#x27;,
                        flex : 0.1,
                        id : &#x27;login&#x27;
                });
    }
    
	columns.push(
	{
			text : &#x27;Image&lt;br/&gt;Prefix&#x27;,
			dataIndex : &#x27;imagePrefix&#x27;,
			width : 70,
			renderer : renderImagePrefix
		}, {
			text : &#x27;Run&lt;br/&gt;No&#x27;,
			dataIndex : &#x27;dataCollectionNumber&#x27;,
			flex : 0.02
		}, {
			text : &#x27;#&lt;br/&gt;images&#x27;,
			dataIndex : &#x27;numberOfImages&#x27;,
			flex : 0.05
		});

	if (!this.displayLastCollect) {
		columns.push({
				text : &#x27;Exp.&lt;br/&gt;Param.&lt;br/&gt;&#x27;,
				dataIndex : &#x27;experimentParameters&#x27;,
				flex : 0.05,
				renderer : renderExperimentParameter
			});

		columns.push({
				text : &#x27;Wavelenth&#x27;,
				dataIndex : &#x27;wavelength&#x27;,
				flex : 0.07,
				renderer : renderFixed3
			}, {
				text : &#x27;Transm.&#x27;,
				dataIndex : &#x27;transmission&#x27;,
				flex : 0.07,
				renderer : renderFixed3
			});
		if (this.isIndustrial) {
			columns.push({
					text : &#x27;Distance&#x27;,
					dataIndex : &#x27;detectorDistance&#x27;,
					flex : 0.05,
					renderer : renderFixed2
				});
		}
		columns.push({
				text : &#x27;Ex.&lt;br&gt;Time&#x27;,
				dataIndex : &#x27;exposureTime&#x27;,
				flex : 0.05,
				renderer : renderFixed2
			}, {
				text : &#x27;Phi&lt;br&gt;start&#x27;,
				dataIndex : &#x27;axisStart&#x27;,
				flex : 0.05,
				renderer : renderFixed2
			}, {
				text : &#x27;Phi&lt;br&gt;range&#x27;,
				dataIndex : &#x27;axisRange&#x27;,
				flex : 0.05,
				renderer : renderFixed2
			});
		if (this.isIndustrial) {
			columns.push({
					text : &#x27;Xbeam&#x27;,
					dataIndex : &#x27;xbeam&#x27;,
					flex : 0.05,
					renderer : renderFixed2
				}, {
					text : &#x27;Ybeam&#x27;,
					dataIndex : &#x27;ybeam&#x27;,
					flex : 0.05,
					renderer : renderFixed2
				});
		}
		columns.push({
				text : &#x27;Detector&lt;br/&gt;Resolution&#x27;,
				dataIndex : &#x27;resolution&#x27;,
				flex : 0.07,
				renderer : renderFixed2
			});
	}
	columns.push({
			text : &#x27;Status&#x27;,
			dataIndex : &#x27;status&#x27;,
			flex : 0.05,
			renderer : renderStatus
		}, {
			text : &#x27;Space&lt;br/&gt;Group&#x27;,
			dataIndex : &#x27;autoProc&#x27;,
			width : 70,
			renderer : renderSpaceGroup
		}, {
			text : &#x27;Completeness&#x27;,
			dataIndex : &#x27;completeness&#x27;,
			width : 70,
			renderer : renderCompleteness
		}, {
			text : &#x27;Resolution&#x27;,
			dataIndex : &#x27;resolution&#x27;,
			width : 80,
			renderer : renderResolution
		}, {
			text : &#x27;Rsymm&lt;br/&gt;&lt;small&gt;&lt;i&gt;Inner&lt;br/&gt;Outer&lt;br/&gt;Overall&lt;/i&gt;&lt;/small&gt;&#x27;,
			dataIndex : &#x27;autoProcStatisticsOverall&#x27;,
			width : 40,
			renderer : renderRsymm
		}, {
			text : &#x27;Unit_cell&lt;br/&gt;&lt;small&gt;&lt;i&gt;a, b, c&lt;br/&gt;alpha, beta, gamma&lt;/i&gt;&lt;/small&gt;&#x27;,
			dataIndex : &#x27;autoProcStatisticsInner&#x27;,
			width : 120,
			renderer : renderUnitCell
		}, {
			text : &#x27;Exp.&lt;br/&gt;Type&#x27;,
			dataIndex : &#x27;experimentType&#x27;,
			flex : 0.05
		}, {
			text : &#x27;Protein&lt;br&gt;Acronym&#x27;,
			dataIndex : &#x27;proteinAcronym&#x27;,
			flex : 0.05,
			renderer : renderProteinAcronym
		}, {
			text : &#x27;Start&lt;br/&gt;time&#x27;,
			dataIndex : &#x27;startTime&#x27;,
			width : 75,
			renderer : renderStartDate
		} );

	if (!this.displayLastCollect) {
		columns.push({
				header : &#x27;Sample&lt;br/&gt;Ranking&#x27;,
				dataIndex : &#x27;dataCollectionId&#x27;,
				flex : 0.05,
				renderer : renderCheckBoxRank
			});
	}
	
	if (!this.isIndustrial) {
		columns.push(
			{
				xtype : &#x27;checkcolumn&#x27;,
				header : &#x27;Skip&#x27;,
				dataIndex : &#x27;skipForReport&#x27;,
				flex : 0.04,
				renderer : renderCheckBoxSkip
			}
		);
	}
	
	if (this.displayLastCollect || this.isIndustrial) {
		columns.push({
				text : &#x27;Comments&#x27;,
				dataIndex : &#x27;comments&#x27;,
				flex : 0.2,
				renderer : columnWrap
			});
	} else {
		columns.push({
				text : &#x27;Comments&#x27;,
				dataIndex : &#x27;comments&#x27;,
				flex : 0.2,
				editor : {
					xtype : &#x27;textfield&#x27;,
					allowBlank : true
				},
				renderer : columnWrap
			});
	}
	
	columns.push({	
		xtype : &#x27;actioncolumn&#x27;,
		width : 50,
		header : &#x27;Download&lt;br&gt;autoproc&lt;br&gt;files&#x27;,		
		items : [{
			icon : &#x27;../images/download.png&#x27;,
			tooltip : &#x27;Download autoproc&#x27;,
			getClass : actionItemRenderer,
			handler : function (grid, rowIndex, colIndex) {
				// console.log(&quot;View collect: &quot; + rowIndex + &quot; = &quot; +_this.store.getAt(rowIndex).data.dataCollectionId);
				_this.downloadAutoproc(_this.store.getAt(rowIndex).data.dataCollectionId);
			}
		}],
		sortable : false
	});
	
	return columns;

};


// redirection to the detail of a collect
DataCollectionMxGrid.prototype.viewDataCollection = function (dataCollectionId) {
	document.location.href = this.contextPath + 
			&quot;/menuSelected.do?leftMenuId=-1&amp;topMenuId=16&amp;targetUrl=/user/viewDataCollection.do?reqCode=displayForDataCollectionGroup&amp;dataCollectionGroupId=&quot; + dataCollectionId;
};


// returns the paging mode
DataCollectionMxGrid.prototype.getPagingMode = function () {
	return this.pagingMode;
};

// hode or show the experiment parameters columns
DataCollectionMxGrid.prototype.hideAndShowExperimentParameter = function () {
	this.hideCol = !this.hideCol;
	this._hideCol();
};


// returns the dataCollections as json
DataCollectionMxGrid.prototype.getListDataCollection = function () {
	var jsonData = Ext.encode(Ext.pluck(this.store.data.items, &#x27;data&#x27;));
	return jsonData;
};

// change rank EDNA or AutoProc
DataCollectionMxGrid.prototype.changeRank = function () {
	this.rankEDNA = !this.rankEDNA;
	this.setRankValue();
};

// set the rank value, EDNA or autoProc
DataCollectionMxGrid.prototype.setRankValue = function () {
	for (var i = this.minDCId; i &lt;= this.maxDCId; i++) {
		var rankList = document.getElementsByName(&quot;rankIdList[&quot; + i + &quot;]&quot;);
		if (rankList != null &amp;&amp; rankList.item(0) != null) {
			if (this.rankEDNA) {
				rankList.item(0).style.display = &#x27;&#x27;;
			} else {
				rankList.item(0).style.display = &#x27;none&#x27;;
			}
		}
		var rankAutoProcList = document.getElementsByName(&quot;rankIdAutoProcList[&quot; + i + &quot;]&quot;);
		if (rankAutoProcList != null &amp;&amp; rankAutoProcList.item(0) != null) {
			if (this.rankEDNA) {
				rankAutoProcList.item(0).style.display = &#x27;none&#x27;;
			} else {
				rankAutoProcList.item(0).style.display = &#x27;&#x27;;
			}
		}
		var rankImage = document.getElementById(&quot;rankIdImage[&quot; + i + &quot;]&quot;);
		if (rankImage != null) {
			if (this.rankEDNA) {
				rankImage.style.display = &#x27;none&#x27;;
			} else {
				rankImage.style.display = &#x27;&#x27;;
			}
		}
		var rankAutoProcImage = document.getElementById(&quot;rankIdAutoProcImage[&quot; + i + &quot;]&quot;);
		if (rankAutoProcImage != null) {
			if (this.rankEDNA) {
				rankAutoProcImage.style.display = &#x27;&#x27;;
			} else {
				rankAutoProcImage.style.display = &#x27;none&#x27;;
			}
		}
	}

};

// rank click: throws an event
DataCollectionMxGrid.prototype.startRank = function () {
	if (this.rankEDNA) {
		this.onRankButtonClicked.notify({});
	} else {
		this.onRankAutoProcButtonClicked.notify({});
	}
};

// returns the list of collect to rank for EDNA
DataCollectionMxGrid.prototype.getListDataCollectionRank = function () {
	var dataCollectionIds = [];
	for (var i = this.minDCId; i &lt;= this.maxDCId; i++) {
		var rankList = document.getElementsByName(&quot;rankIdList[&quot; + i + &quot;]&quot;);
		if (rankList != null &amp;&amp; rankList.item(0) != null) {
			dataCollectionIds.push(i);
		}
	}
	return dataCollectionIds;
};

// returns the list of collect to rank for autoproc
DataCollectionMxGrid.prototype.getListDataCollectionRankAutoProc = function () {
	var dataCollectionIds = [];
	for (var i = this.minDCId; i &lt;= this.maxDCId; i++) {
		var rankList = document.getElementsByName(&quot;rankIdAutoProcList[&quot; + i + &quot;]&quot;);
		if (rankList != null &amp;&amp; rankList.item(0) != null) {
			dataCollectionIds.push(i);
		}
	}
	return dataCollectionIds;
};

// return the list of collects to skip
DataCollectionMxGrid.prototype.getListDataCollectionSkip = function () {
	var dataCollectionIds = [];
	for (var i = this.minDCId; i &lt;= this.maxDCId; i++) {
		var skipList = document.getElementsByName(&quot;skipIdList[&quot; + i + &quot;]&quot;);
		if (skipList != null &amp;&amp; skipList.item(0) != null &amp;&amp; skipList.item(0) == false ) {
			dataCollectionIds.push(i);
		}
	}
	return dataCollectionIds;
};


// download autoprocessing files redirection
DataCollectionMxGrid.prototype.downloadAutoproc = function (dataCollectionId) {
	var rmerge = this.rMergeCutoff;
	var isigma = this.iSigmaCutoff;
	document.location.href = this.contextPath +  &quot;/menuSelected.do?leftMenuId=-1&amp;topMenuId=16&amp;targetUrl=/user/viewDataCollection.do?reqCode=download&amp;dataCollectionId=&quot; + dataCollectionId + &quot;&amp;rmerge=&quot; + rmerge + &quot;&amp;isigma=&quot; + isigma + &quot;&amp;anomalous=false&quot;;
	// &quot;/menuSelected.do?leftMenuId=-1&amp;topMenuId=16&amp;targetUrl=/user/viewDataCollection.do?reqCode=download&amp;dataCollectionId=&quot; + dataCollectionId + &quot;&amp;rmerge=&quot; + vdcForm.getRMergeCutoff() + &quot;&amp;isigma=&quot; + vdcForm.getISigmaCutoff() + &quot;&amp;anomalous=false&quot;;
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
