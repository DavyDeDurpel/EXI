<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/widget/spreadsheet/containerspreadsheet.js - EXI</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EXI" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AutoProcIntegrationGrid.html">AutoProcIntegrationGrid</a></li>
                                <li><a href="../classes/ManagerWelcomeMainView.html">ManagerWelcomeMainView</a></li>
                                <li><a href="../classes/PhasingNetworkWidget.html">PhasingNetworkWidget</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: js/widget/spreadsheet/containerspreadsheet.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
function ContainerSpreadSheet(args){
	this.id = BUI.id();
	this.height = 380;
	this.width = 500;
	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.width != null) {
			this.width = args.width;
		}
	}
	
	this.onModified = new Event(this);
}

ContainerSpreadSheet.prototype.getPanel = function(){
	var _this = this;
	this.panel = Ext.create(&#x27;Ext.panel.Panel&#x27;, {
		layout : &#x27;vbox&#x27;,
		height 		: this.height+ 50,
		items : [ 
				  {
						html 		: &#x27;&lt;div  style=&quot;overflow: auto;overflow-y: hidden; border:1px solid gray;background-color:white;height:500px;width:&#x27; + (_this.width - 20) +&#x27;px&quot;; id=&quot;&#x27; + this.id + &#x27;_samples&quot;; &gt;&lt;/div&gt;&#x27;,
						margin 		: &#x27;20 0 20 10&#x27;,
						height 		: this.height,
						width 		: this.width,
						autoScroll 	: true,
						resizable 	: true
					}]
	});
    return this.panel;
};


ContainerSpreadSheet.prototype.getSamplesData = function(puck) {
	var samples = puck.sampleVOs;
	var data = [];
	/** Sorting samples by location * */
	samples.sort(function(a,b){return Number(a.location) - Number(b.location);});
	function getSampleByLocation(samples, location){
		for (var i = 0; i &lt; samples.length; i++) {
			if (samples[i].location == Number(location)){
				return samples[i];
			}
		}
	}

	function getValue(value){
		if (!value) return &quot;&quot;;
	}
	
	for (var i = 0; i &lt; puck.capacity; i++) {
		var sample = getSampleByLocation(samples, i + 1);
		if (sample!= null){
				var crystal = sample.crystalVO;
				var protein = crystal.proteinVO;
				var diffraction = sample.diffractionPlanVO;
				if (diffraction == null){
					diffraction = {};
				}
				data.push(
					[(i+1), protein.acronym, sample.name, crystal.spaceGroup, diffraction.experimentKind, sample.code,  getValue(diffraction[&quot;observedResolution&quot;]),  diffraction.requiredResolution, diffraction.preferredBeamDiameter, 
					 diffraction.numberOfPositions, diffraction.radiationSensitivity, diffraction.requiredMultiplicity, diffraction.requiredCompleteness,
					 crystal.cellA, crystal.cellB, crystal.cellC, crystal.cellAlpha, crystal.cellBeta, crystal.cellGamma, sample.smiles, sample.comments
					 ]
				);
		}
		else{
			data.push([(i+1)]);
		}
	}
	return data;
};


ContainerSpreadSheet.prototype.getSpaceGroups = function() {
	return [&quot;P1&quot;,&quot;P2&quot;,&quot;P21&quot;,&quot;C2&quot;,&quot;P222&quot;,&quot;P2221&quot;,&quot;P21212&quot;,&quot;P212121&quot;,&quot;C222&quot;,&quot;C2221&quot;,&quot;F222&quot;,&quot;I222&quot;,&quot;I212121&quot;,&quot;P4&quot;,&quot;P41&quot;,&quot;P42&quot;,&quot;P43&quot;,&quot;P422&quot;,&quot;P4212&quot;,&quot;P4122&quot;,&quot;P41212&quot;,&quot;P4222&quot;,&quot;P42212&quot;,&quot;P4322&quot;,&quot;P43212&quot;,
                	&quot;I4&quot;,&quot;I41&quot;,&quot;I422&quot;,&quot;I4122&quot;,&quot;P3&quot;,&quot;P31&quot;,&quot;P32&quot;,&quot;P31&quot;,&quot;P321&quot;,&quot;P3112&quot;,&quot;P3121&quot;,&quot;P3212&quot;,&quot;P3221&quot;,&quot;P6&quot;,&quot;P61&quot;,&quot;P65&quot;,&quot;P62&quot;,&quot;P64&quot;,&quot;P63&quot;,&quot;P622&quot;,&quot;P6122&quot;,&quot;P6522&quot;,&quot;P6222&quot;,&quot;P6422&quot;,&quot;P6322&quot;,&quot;R3&quot;,&quot;R32&quot;,&quot;P23&quot;,&quot;P213&quot;,
                	&quot;P432&quot;,	&quot;P4232&quot;,&quot;P4332&quot;,&quot;P4132&quot;,&quot;F23&quot;,&quot;F432&quot;,&quot;F4132&quot;,&quot;I23&quot;,	&quot;I213&quot;,&quot;I432&quot;,&quot;I4132&quot;, &quot;UNKNOWN&quot;];
};


ContainerSpreadSheet.prototype.getAcronyms = function() {
	var proteins = EXI.proposalManager.getProteins();
	var acronyms = [];
	for (var i = 0; i &lt; proteins.length; i++) {
		acronyms.push(proteins[i].acronym);
	}
	return acronyms;
};


ContainerSpreadSheet.prototype.getHeader = function() {
	return  [
	         { text : &#x27;#&#x27;, 	id: &#x27;position&#x27;, column : {width : 20}}, 
	         { text :&#x27;Protein &lt;br /&gt;Acronym&#x27;, id :&#x27;Protein Acronym&#x27;, 	column :  {
																						width : 60,
																						type: &#x27;dropdown&#x27;,
																						source: this.getAcronyms()
																					}
	         }, 
	         { text :&#x27;Sample&lt;br /&gt; Name&#x27;, id :&#x27;Sample Name&#x27;, column : {width : 50}}, 
	         { text :&#x27;Space&lt;br /&gt; Group&#x27;, id : &#x27;Space Group&#x27;,column : {
			        	 													width : 60,
			        	 													type: &#x27;dropdown&#x27;,
			        	 													source: this.getSpaceGroups()
			         								}
	         }, 
	         { text :&#x27;Exp.&lt;br /&gt; Type&#x27;, id : &#x27;Experiment Type&#x27;, column : {
							        	 								width : 90,  
							        	 								type: &#x27;dropdown&#x27;,
							        	 								source: [ &quot;Default&quot;, &quot;MXPressE&quot;, &quot;MXPressO&quot;, &quot;MXPressI&quot;, &quot;MXPressE_SAD&quot;, &quot;MXScore&quot;, &quot;MXPressM&quot; ]
							         								}
	         }, 
	         { text :&#x27;Pin &lt;br /&gt;BarCode&#x27;, id : &#x27;Pin BarCode&#x27;, column : {width : 45}},  
	         { text :&#x27;Pre-observed &lt;br /&gt;resolution&#x27;, id : &#x27;Pre-observed resolution&#x27;, column : {width : 45}}, 
	         { text :&#x27;Needed&lt;br /&gt; resolution&#x27;,  id :&#x27;Needed resolution&#x27;, column : {width : 45}}, 
	         { text :&#x27;Pref. &lt;br /&gt;Diameter&#x27;, id :&#x27;Pref. Diameter&#x27;,column : {width : 45}}, 
	         { text :&#x27;Number Of&lt;br /&gt; positions&#x27;, id :&#x27;Number Of positions&#x27;, column : {width : 45}}, 
	         { text :&#x27;Radiation&lt;br /&gt; Sensitivity&#x27;, id :&#x27;Radiation Sensitivity&#x27;, column : {width : 60}}, 
	         { text :&#x27;Required&lt;br /&gt; multiplicity&#x27;, id :&#x27;Required multiplicity&#x27;, column : {width : 60}}, 
	         { text :&#x27;Required&lt;br /&gt; Completeness&#x27;, id :&#x27;Required Completeness&#x27;, column : {width : 60}}, 
	         { text :&#x27;A&#x27;, id :&#x27;Unit cell A&#x27;, column : {width : 30}}, 
	         { text :&#x27;B&#x27;, id :&#x27;Unit cell B&#x27;, column : {width : 30}}, 
	         { text :&#x27;C&#x27;, id : &#x27;Unit cell C&#x27;, column : {width : 30}}, 
	         { text :&#x27;&amp;#945;&#x27;, id :&#x27;Unit cell Alpha&#x27;, column : {width : 30}}, 
	         { text :&#x27;&amp;#946;&#x27;, id :&#x27;Unit cell Beta&#x27;, column : {width : 30}}, 
	         { text :&#x27;&amp;#947;&#x27;, id :&#x27;Unit cell Gamma&#x27;, column : {width : 30}}, 
	         { text :&#x27;Smiles&#x27;, id :&#x27;Required Completeness&#x27;, column : {width : 45}}, 
	         { text :&#x27;Comments&#x27;, id :&#x27;Comments&#x27;, column : {width : 45}}
	         ];
};

ContainerSpreadSheet.prototype.getHeaderWidth = function() {
	var header = this.getHeader();
	var text = [];
	for (var i =0; i &lt; header.length; i++){
		text.push(header[i].column.with);
	}
	return text;
};

ContainerSpreadSheet.prototype.getHeaderId = function() {
	var header = this.getHeader();
	var text = [];
	for (var i =0; i &lt; header.length; i++){
		text.push(header[i].id);
	}
	return text;
};

ContainerSpreadSheet.prototype.getHeaderText = function() {
	var header = this.getHeader();
	var text = [];
	for (var i =0; i &lt; header.length; i++){
		text.push(header[i].text);
	}
	return text;
};


ContainerSpreadSheet.prototype.getColumns = function() {
	var columns = [];
	for (var i = 0; i &lt; this.getHeader().length; i++) {
		columns.push(this.getHeader()[i].column);
	}
	return columns;
};


ContainerSpreadSheet.prototype.getPuck = function() {
	var myPuck = JSON.parse(JSON.stringify(this.puck));
	var rows = this.parseTableData();
	myPuck.sampleVOs = [];
	for (var i = 0; i &lt; rows.length; i++) {
		var sample = {}; // getSamplesByLocation(rows[i].location);
		sample[&quot;name&quot;] = rows[i][&quot;Sample Name&quot;];
		sample[&quot;smiles&quot;] = rows[i][&quot;Smiles&quot;];
		sample[&quot;location&quot;]= rows[i][&quot;location&quot;];
		sample[&quot;comments&quot;] = rows[i][&quot;Comments&quot;];
		if (sample[&quot;crystalVO&quot;] == null){
			sample[&quot;crystalVO&quot;] = {};
			sample[&quot;crystalVO&quot;][&quot;proteinVO&quot;] = EXI.proposalManager.getProteinByAcronym(rows[i][&quot;Protein Acronym&quot;]);
		}
		sample[&quot;crystalVO&quot;][&quot;spaceGroup&quot;] = rows[i][&quot;Space Group&quot;];
		sample[&quot;crystalVO&quot;][&quot;cellA&quot;] = Number(rows[i][&quot;Unit cell A&quot;]);
		sample[&quot;crystalVO&quot;][&quot;cellB&quot;] = Number(rows[i][&quot;Unit cell B&quot;]);
		sample[&quot;crystalVO&quot;][&quot;cellC&quot;] = Number(rows[i][&quot;Unit cell C&quot;]);
		sample[&quot;crystalVO&quot;][&quot;cellAlpha&quot;] = Number(rows[i][&quot;Unit cell Alpha&quot;]);
		sample[&quot;crystalVO&quot;][&quot;cellBeta&quot;] = Number(rows[i][&quot;Unit cell Beta&quot;]);
		sample[&quot;crystalVO&quot;][&quot;cellGamma&quot;] = Number(rows[i][&quot;Unit cell Gamma&quot;]);
		
		sample[&quot;diffractionPlanVO&quot;] = {};
		sample[&quot;diffractionPlanVO&quot;][&quot;radiationSensitivity&quot;]= Number(rows[i][&quot;Radiation Sensitivity&quot;]);
		sample[&quot;diffractionPlanVO&quot;][&quot;requiredCompleteness&quot;]= Number(rows[i][&quot;Required Completeness&quot;]);
		sample[&quot;diffractionPlanVO&quot;][&quot;requiredMultiplicity&quot;]= Number(rows[i][&quot;Required multiplicity&quot;]);
		sample[&quot;diffractionPlanVO&quot;][&quot;requiredResolution&quot;]= Number(rows[i][&quot;Needed resolution&quot;]);
		sample[&quot;diffractionPlanVO&quot;][&quot;observedResolution&quot;]= Number(rows[i][&quot;Pre-observed resolution&quot;]);
		sample[&quot;diffractionPlanVO&quot;][&quot;preferredBeamDiameter&quot;]= Number(rows[i][&quot;Pref. Diameter&quot;]);
		sample[&quot;diffractionPlanVO&quot;][&quot;numberOfPositions&quot;]= Number(rows[i][&quot;Number Of positions&quot;]);
		sample[&quot;diffractionPlanVO&quot;][&quot;experimentKind&quot;]= rows[i][&quot;Experiment Type&quot;];
		
		myPuck.sampleVOs.push(sample);
	}
	return myPuck;
};


ContainerSpreadSheet.prototype.parseTableData = function() {
	var parsed = [];
	var data = this.spreadSheet.getData();
	for (var j = 0; j &lt; data.length; j++) {
		var row = {};
		row[&quot;location&quot;] = j + 1;
			for (var k = 0; k &lt; data[j].length; k++) {
				var key = this.getHeaderId()[k];
				var value = data[j][k];
				row[key] = value;
			}
			if (row[&quot;Protein Acronym&quot;]){
				if (row[&quot;Protein Acronym&quot;].length &gt; 0){
					parsed.push(row);
				}
			}
	}
	
	/** Curated contains the whole-data rows * */
	var curated = [];
	for (var i = 0; i &lt; parsed.length; i++) {
		if (parsed[i][&quot;Protein Acronym&quot;] != null){
			curated.push(parsed[i]);
		}
	}
	
	return curated;
};

ContainerSpreadSheet.prototype.load = function(puck){
	this.puck = puck;
	var container = document.getElementById(this.id + &#x27;_samples&#x27;);
    
	  function firstRowRenderer(instance, td, row, col, prop, value, cellProperties) {
	    Handsontable.renderers.TextRenderer.apply(this, arguments);
	    td.style.fontWeight = &#x27;bold&#x27;;
	    td.style.color = &#x27;green&#x27;;
	    td.style.fontSize = &#x27;9px&#x27;;
	    td.style.background = &#x27;#CEC&#x27;;
	  }
	  
	  function ValueRenderer(instance, td, row, col, prop, value, cellProperties) {
	    Handsontable.renderers.TextRenderer.apply(this, arguments);
	    if (!instance.getDataAtRow(row)[1]){
	    	td.style.background = &#x27;#EEE&#x27;;
	    	return;
	    }
	    
	    if ((col == 2)){
		    	if (!value || value == &#x27;&#x27;) {
		    		td.className = &#x27;custom-row-text-required&#x27;;
		  	    }
	    }
	  }
	  // maps function to lookup string
	  Handsontable.renderers.registerRenderer(&#x27;ValueRenderer&#x27;, ValueRenderer);
	  var _this = this;
	  this.spreadSheet = new Handsontable(container, {
		beforeChange: function (changes, source) {
		      lastChange = changes;
		      
		},
	    data: this.getSamplesData(puck),
	    colWidths: 70,
	    height : this.height,
	    width : this.width,
	    manualColumnResize: true,
	    colWidths: this.getHeaderWidth(),
	    colHeaders: this.getHeaderText(),
	    stretchH: &#x27;last&#x27;,
	    columns: this.getColumns()
	  });

	  
	  this.spreadSheet.updateSettings({
		  afterChange: function (changes, source) {
				_this.onModified.notify(_this.getPuck());
				/*try{
					_this.loadPlateLayout(_this.parseData(_this.spreadSheet.getData()));
				}catch(e){
					console.log(e);
				}*/
		  }
		});
	
	
};
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
