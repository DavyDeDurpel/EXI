<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/widget/network/phasing/phasingnetworkwidget.js - EXI</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EXI" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AutoProcIntegrationGrid.html">AutoProcIntegrationGrid</a></li>
                                <li><a href="../classes/ManagerWelcomeMainView.html">ManagerWelcomeMainView</a></li>
                                <li><a href="../classes/PhasingNetworkWidget.html">PhasingNetworkWidget</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: js/widget/network/phasing/phasingnetworkwidget.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
* This class renders a network graph with the PhasingStep
*
* @class PhasingNetworkWidget
* @constructor
*/
function PhasingNetworkWidget(args){
	this.id = BUI.id();
	this.data = [];

	/** &quot;OPEN_VIEWER&quot; **/
	this.tbar = &quot;MENU&quot;;
	
	this.layout = {
			improvedLayout : true
			
	};
    
	if (args != null){
		if (args.tbar != null){
			this.tbar = args.tbar;
		}
	}
}

PhasingNetworkWidget.prototype.clear = function(){
	document.getElementById(this.id).innerHTML = &quot;&quot;;
};

PhasingNetworkWidget.prototype.getTbar = function(){
	var _this = this;
	if (this.tbar == &quot;MENU&quot;){
		return [
						Ext.create(&#x27;Ext.button.Split&#x27;, {
						    text: &#x27;View&#x27;,
						    handler: function() {
						       
						    },
						    menu: new Ext.menu.Menu({
						        items: [
									{
										text: &#x27;Default&#x27;, 
										handler: function(){ 
											_this.layout = {
											    };
											_this.render();
										
									}},
						            {
						            	text: &#x27;Horizontal&#x27;,      	
						            	handler: function(){ 
						            		_this.layout = {
						            		        hierarchical: {
						            		            direction: &quot;UD&quot;,
						            		            levelSeparation : 100
						            		        }
						            		    };
						            		_this.render();
						            	
						            }},
						            {
 
						            	text: &#x27;Vertical&#x27;, 
						            	handler: function(){ 
						            		_this.layout = {
						            		        hierarchical: {
						            		            direction: &quot;LR&quot;,
						            		            levelSeparation : 100
						            		        }
						            		    };
						            		_this.render();
						            	
						            }},
						        ]
						    })
						})
		       ];
		
	}
	else{
		return [
		           { 
		        	   xtype: &#x27;button&#x27;, 
		        	   text: &#x27;Open Viewer&#x27;, 
		        	   handler : function(sender){
		        		   location.hash = &quot;/autoprocintegration/datacollection/&quot; + _this.data[0].v_datacollection_summary_phasing_dataCollectionId + &quot;/phasingviewer/main&quot;;
		        	   } 
		           }
	    ];
	}
};

PhasingNetworkWidget.prototype.getPanel = function(){
	var _this = this;
	this.panel = Ext.create(&#x27;Ext.panel.Panel&#x27;, {
	   layout : &#x27;fit&#x27;,
	    border: 1,
	    margin : 5,
	    tbar: this.getTbar(),
	    cls : &quot;borderGrid&quot;,
	    items: [
	    {
	    	html : &quot;&lt;div style=&#x27; height: 600px;min-height: 100% !important;display:block;overflow:auto;&#x27; id=&#x27;&quot; + this.id +&quot;&#x27;&gt;Select an autoprocIntegration&lt;/div&gt;&quot;
	    }],
	    listeners : {
			afterrender : function(component, eOpts) {
				_this.render();
		}
	    }
	});
	return this.panel;
};


PhasingNetworkWidget.prototype.getLabelByNode = function(node){
	if (node.v_datacollection_summary_phasing_phasingStepType == &quot;PREPARE&quot;){
		return &quot;PR&quot; +
				&quot;\n&quot; +
				node.v_datacollection_summary_phasing_phasingPrograms +
				&quot;\n&quot; +
				node.v_datacollection_summary_phasing_lowRes + &quot; - &quot; + node.v_datacollection_summary_phasing_highRes +
				&quot;\n&quot; +
				node.v_datacollection_summary_phasing_spaceGroupShortName +
				&quot;\n&quot; +
				node.v_datacollection_summary_phasing_method
				
		
	}
	
	if (node.v_datacollection_summary_phasing_phasingStepType == &quot;PHASING&quot;){
		return &quot;PH&quot; +
		&quot;\n&quot; +
		node.v_datacollection_summary_phasing_phasingPrograms +
		&quot;\n&quot; +
		node.v_datacollection_summary_phasing_spaceGroupShortName +
		&quot;\n&quot; +
		node.v_datacollection_summary_phasing_lowRes + &quot; - &quot; + node.v_datacollection_summary_phasing_highRes +
		&quot;\n&quot; +
		&quot;Enan: &quot; + node.v_datacollection_summary_phasing_enantiomorph + 
		&quot;\n&quot; +
		&quot;Solvent: &quot; + node.v_datacollection_summary_phasing_solventContent;
		
	}
	
	if (node.v_datacollection_summary_phasing_phasingStepType == &quot;SUBSTRUCTUREDETERMINATION&quot;){
		return &quot;SUB&quot; +
		&quot;\n&quot; +
		node.v_datacollection_summary_phasing_phasingPrograms +
		&quot;\n&quot; +
		node.v_datacollection_summary_phasing_spaceGroupShortName +
		&quot;\n&quot; +
		node.v_datacollection_summary_phasing_lowRes + &quot; - &quot; + node.v_datacollection_summary_phasing_highRes; 
	}
	return node.v_datacollection_summary_phasing_phasingStepType;
};
/**
* It renders the network by using viz.js
* http://visjs.org/
*
* @method render
*/
PhasingNetworkWidget.prototype.render = function(){
	var _this =this;
	 
	_this.panel.setLoading(&quot;Rendering&quot;);
//	$.when(_this._render()).then(function( data, textStatus, jqXHR ) {
//		  _this.panel.setLoading(false);
//	});
	/* contrived example alert */
	setTimeout(function(){  _this.panel.setLoading(false); }, 6000);
	setTimeout(function(){ _this._render(); }, 1000);
//	_this._render();
	
};


PhasingNetworkWidget.prototype._render = function(){
	var nodes = [];
	var edges = [];
	
	/** Start Node **/
	nodes.push({
		id 		: 1,
		label 	: &quot;START&quot;,
		font	: {size:32}
	});
	
	for (var i = 0; i &lt; this.data.length; i++) {
		if (this.data[i].v_datacollection_summary_phasing_phasingStepId != null){
			var color = &#x27;lime&#x27;;
			switch(this.data[i].v_datacollection_summary_phasing_phasingStepType) {
				    case &quot;PREPARE&quot;:
				        color = &quot;#FF5733&quot;;
				        break;
				    case &quot;SUBSTRUCTUREDETERMINATION&quot;:
				    	color = &quot;#FFF8A8&quot;;
				        break;
				    default:
				    	color = &#x27;#B7A800&#x27;;
			}
			
			nodes.push({
				id 		: this.data[i].v_datacollection_summary_phasing_phasingStepId,
				label 	: this.getLabelByNode(this.data[i]),// + &quot;-- &quot; + this.data[i].v_datacollection_summary_phasing_spaceGroupShortName,
				color	: color,
				font	: {size:8}
			});
			
			
			/** Edges **/
			var previous = this.data[i].v_datacollection_summary_phasing_previousPhasingStepId;
			var label = &quot;&quot;;
			
			/** This is root **/
			if (previous == null){
//					label = this.data[i].v_datacollection_summary_phasing_spaceGroupShortName;
					if (this.data[i].v_datacollection_summary_phasing_phasingStepType == &quot;PHASING&quot;){
						previous = -1;
					}
					else{
						/** Adding spacegroup Node**/
						nodes.push({
							id 		: this.data[i].v_datacollection_summary_phasing_phasingStepId + this.data[i].v_datacollection_summary_phasing_spaceGroupShortName,
							label 	: this.data[i].v_datacollection_summary_phasing_spaceGroupShortName,
							color	: &quot;orange&quot;,
							font	: {size:32}
						});
						previous = this.data[i].v_datacollection_summary_phasing_phasingStepId + this.data[i].v_datacollection_summary_phasing_spaceGroupShortName;
						
						edges.push({
							 from	: 1, 
							 to		: this.data[i].v_datacollection_summary_phasing_phasingStepId + this.data[i].v_datacollection_summary_phasing_spaceGroupShortName,
							 label	: label,
							 arrows	:&#x27;to&#x27;,
							 font	: {size:32}
						});
					}
			}
			
			
			
			
			edges.push({
					 from	: previous, 
					 to		: this.data[i].v_datacollection_summary_phasing_phasingStepId,
					 label	: label,
					 arrows	:&#x27;to&#x27;,
					 font	: {size:32}
			});
		}
	}
	  var container = document.getElementById(&#x27;mynetwork&#x27;);
	  var data = {
	    nodes: nodes,
	    edges: edges
	  };
	  var options = {
			  edges: {
//                  smooth: {
//                      type: &#x27;cubicBezier&#x27;,
//                      forceDirection: &#x27;vertical&#x27; ,
//                      roundness: 0.4,
//                  },
              },
			  layout : this.layout
	  };
	  
	  this.network = new vis.Network(document.getElementById(this.id), data, options)
};

/**
* It just loads the data but it will not be rendered
* Rendering is done when afterrender method is triggered
*
* @method load
* @param {Object} autoprocIntegrationList This is a list of autoprocintegration retrieved from the phasing view
*/
PhasingNetworkWidget.prototype.load = function(autoprocIntegrationList){	
	/** First we concat all arrays **/
	this.data = [].concat.apply([], autoprocIntegrationList);
	
	if (document.getElementById(this.id) != null){
		this.clear();
		this.render();
	}
	
	
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
