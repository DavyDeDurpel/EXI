<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/widget/tabs/templatetabs.js - EXI</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EXI" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ManagerWelcomeMainView.html">ManagerWelcomeMainView</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: js/widget/tabs/templatetabs.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Shows an template with the specimens, measurements and the experiment&#x27;s
 * requirement
 * 
 * @targetId
 */
function TemplateTabs(targetId) {
	this.height = 600;
	this.targetId = targetId;

	this.id = BUI.id();
	var _this = this;

	this.gridHeight = 1000;
	/** data * */
	this.experiment = null;

	this.specimenSelected = null;

	/** Specimen Widget contains a specimenGrid and a sampleChangerWidget than can be displayed with are vertical or horizontal layout **/
	this.specimenWidget = new SpecimenWidget({
		height : this.height
	});
	
	this.samplePlateGroupWidget = new SamplePlateGroupWidget({
		showTitle : false,
		height : 250,
		margin : 5,
		bbar : true
	});
	
	this.samplePlateGroupWidget.onExperimentChanged.attach(function(sender, experiment) {
		_this.refresh(experiment);
	});

	this.samplePlateGroupWidget.onClick.attach(function(sender, args) {
	});

	this.volumePlanificator = new VolumeGrid();

	/** For Measurements * */
	var storeViscosity = Ext.create(&#x27;Ext.data.Store&#x27;, {
		fields : [ &#x27;name&#x27; ],
		data : [ {
			&quot;name&quot; : &quot;low&quot;
		}, {
			&quot;name&quot; : &quot;medium&quot;
		}, {
			&quot;name&quot; : &quot;high&quot;
		} ]
	});

	// Create the combo box, attached to the states data store
	var viscosityEditor = Ext.create(&#x27;Ext.form.ComboBox&#x27;, {
		fieldLabel : &#x27;&#x27;,
		store : storeViscosity,
		queryMode : &#x27;local&#x27;,
		displayField : &#x27;name&#x27;,
		valueField : &#x27;name&#x27;
	});

	this.measurementGrid = new MeasurementGrid({
		maxWidth : 1500,
		estimateTime : false,
		positionColumnsHidden : true,
		isPriorityColumnHidden : true,
		isStatusColumnHidden : true,
		isTimeColumnHidden : true,
		updateRowEnabled : true,
		collapsed : true,
		removeBtnEnabled : true,
		showTitle : false,
		collapseBtnEnable : false,
		addBtnMultipleEdit : true,
		sortingBtnEnable : true,
		editor : {
			exposureTemperature : {
				xtype : &#x27;textfield&#x27;,
				allowBlank : true
			},
			comments : {
				xtype : &#x27;textfield&#x27;,
				allowBlank : true
			},
			volumeToLoad : {
				xtype : &#x27;numberfield&#x27;,
				allowBlank : true
			},
			transmission : {
				xtype : &#x27;numberfield&#x27;,
				allowBlank : true
			},
			viscosity : viscosityEditor,
			waitTime : {
				xtype : &#x27;numberfield&#x27;,
				allowBlank : true
			},
			flow : {
				xtype : &#x27;checkbox&#x27;,
				allowBlank : true
			}
		}
	});

	this.measurementGrid.onSelected.attach(function(sender, measurements) {
		var specimens = [];
		for ( var i = 0; i &lt; measurements.length; i++) {
			specimens.push(_this.experiment.getSampleById(measurements[i].specimenId));
		}
	});

	this.measurementGrid.onMeasurementChanged.attach(function(sender, measurement) {
		_this.experiment.setMeasurement(measurement);
		_this.refresh(_this.experiment);
	});

	this.measurementGrid.onExperimentChanged.attach(function(sender, json) {
		_this.refresh(new Experiment(json));
	});

	this.measurementGrid.onRemoved.attach(function(sender, experiment) {
		_this.refreshSpecimen(new Experiment(experiment));
	});

	this.measurementGrid.onUpdateTime.attach(function(sender, args) {
		document.getElementById(_this.id + &quot;_counter&quot;).innerHTML = args.hours + &#x27;h,  &#x27; + args.minutes + &#x27;min and &#x27; + args.seconds + &#x27; seconds&#x27;;
	});
	
}

TemplateTabs.prototype.refreshMeasurement = function(experiment) {
	this.experiment = experiment;
	this.experiment.onSaved = new Event(this);
	this.experiment.onSpecimenSaved = new Event(this);
	var experimentList = new ExperimentList([ this.experiment ]);
	this.measurementGrid.refresh(experimentList.getMeasurementsNotCollected(), experimentList);
};

TemplateTabs.prototype.refreshSpecimen = function(experiment) {
	this.experiment = experiment;
	this.experiment.onSaved = new Event(this);
	this.experiment.onSpecimenSaved = new Event(this);
	this.samplePlateGroupWidget.refresh(this.experiment);
	this.specimenWidget.refresh(this.experiment);
	this.volumePlanificator.refresh(this.experiment);
};

TemplateTabs.prototype.refresh = function(experiment) {
	// var start = new Date().getTime();
	this.experiment = experiment;
	this.experiment.onSaved = new Event(this);
	this.experiment.onSpecimenSaved = new Event(this);

	// var experimentList = new ExperimentList([this.experiment]);
	this.refreshMeasurement(experiment);
	this.refreshSpecimen(experiment);
	/** Refreshing grids * */
	this.panel.setLoading(false);

};

TemplateTabs.prototype.error = function(error) {
	var e = JSON.parse(error);
	showError(e);
	this.panel.setLoading(false);

};

TemplateTabs.prototype.draw = function(experiment) {
	this.render(experiment);
};


TemplateTabs.prototype.getExperimentTitle = function() {
	var _this = this;
	var experimentHeaderForm = new ExperimentHeaderForm();
	return experimentHeaderForm.getPanel(this.experiment);
};

TemplateTabs.prototype.render = function(experiment) {
	var _this = this;
	this.experiment = experiment;

	/** 
	 * 
	 * Depending on the sample Changer configuration we want to display the plates vertically or horizontally 
	 * Default is vertical
	 * 
	 * */
	
	var specimenContainer = this.specimenWidget.getPanel();
	this.specimenWidget.refresh(experiment);
	
	var experimentList = new ExperimentList([ _this.experiment ]);
	var measurementContainer = Ext.create(&#x27;Ext.container.Container&#x27;, {
		layout : {
			type : &#x27;vbox&#x27;
		},
		defaults : {
			style : {
				padding : &#x27;5px 0px 0px 10px&#x27;
			}
		},
		items : [ _this.measurementGrid.getPanel(experimentList.getMeasurementsNotCollected(), experimentList) ]
	});

	this.panel = Ext
			.createWidget(
					&#x27;tabpanel&#x27;,
					{
						plain : true,
						items : [
							{
								tabConfig : {
									title : &#x27;Measurements&#x27;
								},
								items : [ {
									xtype : &#x27;container&#x27;,
									layout : &#x27;vbox&#x27;,
									border : 1,
//									height : _this.gridHeight,
									margin : &quot;0 0 10 0&quot;,
									items : [ measurementContainer ]
								}

								]
							},
							{
								tabConfig : {
									id : &#x27;genralTabl&#x27;,
									title : &quot;Specimens&quot;
								// width : 900,
								// border : 3

								},
								items : [ specimenContainer ]
							},
							{
								tabConfig : {
									title : &quot;Requirements&quot;

								},
								items : [
									{
										html : BUI.getTipHTML(&quot;Estimated volume is the maximum volume required. Depending on the order of your measurements you may use less. Click on create stock solutions if you plan to ship these stock solutions&quot;),
										margin : &quot;10 10 10 10&quot;,
										border : 0
									}, this.volumePlanificator.getPanel(experiment) ]
							} ]
					});
	// );
	return this.getPanel(this.panel);
};

TemplateTabs.prototype.isTemplate = function() {
	if (this.experiment.json.type == &quot;TEMPLATE&quot;) {
		return true;
	}
	return false;
};


TemplateTabs.prototype.getPanel = function(panel) {
	var _this = this;
	if (this.experimentPanel == null) {
		this.experimentPanel = Ext.create(&#x27;Ext.container.Container&#x27;, {
			bodyPadding : 2,
			width : 1000,//Ext.getBody().getViewSize().width * 0.9,
			renderTo : this.targetId,
			height : 500,
//			style : {
//				padding : 2
//			},
			items : [ 
			          this.getExperimentTitle(), 
			          this.panel 
	        ],
			listeners : {
				afterrender : function(thisCmp) {
					$(&quot;#SchemeReport&quot; + _this.experiment.experimentId).click(function() {
						$(this).target = &quot;_blank&quot;;
						window.open(&#x27;viewProjectList.do?reqCode=display&amp;menu=platescheme&amp;experimentId=&#x27; + _this.experiment.experimentId);
						return false;
					});

				}
			}
		});
	}
	return this.experimentPanel;
};

TemplateTabs.prototype.input = function(targetId) {
	return new ExperimentTabs().input();
};

TemplateTabs.prototype.test = function(targetId) {
	var experimentTabs = new TemplateTabs(targetId);
	BIOSAXS.proposal = new Proposal(experimentTabs.input().proposal);
	experimentTabs.draw(new Experiment(experimentTabs.input().experiment));
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
